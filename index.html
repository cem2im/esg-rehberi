<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#C8102E">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš•ï¸</text></svg>">
<title>ESG Rehberim â€” HazÄ±rlÄ±k & Takip</title>
<style>
:root{--bx:#C8102E;--bx-l:rgba(200,16,46,.08);--bx-m:rgba(200,16,46,.15);--dark:#1a1a1a;--body:#444;--muted:#999;--light:#f5f4f2;--card:#fff;--border:#e8e6e3;--green:#1a8d4e;--green-l:rgba(26,141,78,.08);--orange:#e67e22;--orange-l:rgba(230,126,34,.08);--red:#c0392b;--red-l:rgba(192,57,43,.08);--blue:#2980b9;--blue-l:rgba(41,128,185,.08);--purple:#8e44ad;--purple-l:rgba(142,68,173,.08);--sans:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;--r:16px;--sh:0 2px 16px rgba(0,0,0,.06)}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;-webkit-text-size-adjust:100%;scroll-behavior:smooth}
body{font-family:var(--sans);color:var(--body);background:var(--light);line-height:1.5;min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}

/* Screens */
.scr{display:none;min-height:100dvh;padding-bottom:100px}.scr.on{display:block;animation:up .35s ease}
@keyframes up{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

/* Wizard */
.wiz{min-height:100dvh;display:flex;flex-direction:column;justify-content:center;padding:32px 24px;text-align:center}
.wiz-step{display:none}.wiz-step.on{display:block;animation:up .3s ease}
.wiz-emoji{font-size:64px;margin-bottom:16px}
.wiz h2{font-size:26px;font-weight:700;color:var(--dark);line-height:1.3;margin-bottom:8px}
.wiz p.wiz-sub{font-size:16px;color:var(--muted);margin-bottom:28px;line-height:1.5}
.wiz-input{width:100%;padding:18px 20px;border:2px solid var(--border);border-radius:14px;font-size:20px;font-family:var(--sans);color:var(--dark);background:var(--card);text-align:center;appearance:none;-webkit-appearance:none}
.wiz-input:focus{outline:none;border-color:var(--bx)}
.opts2{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:360px;margin:0 auto}
.opt2{display:flex;flex-direction:column;align-items:center;gap:8px;padding:24px 16px;border:2.5px solid var(--border);border-radius:16px;background:var(--card);cursor:pointer;transition:all .2s;text-align:center}
.opt2:active{transform:scale(.97)}.opt2.sel{border-color:var(--bx);background:var(--bx-l)}
.opt2 .o2-ico{font-size:40px}.opt2 h3{font-size:16px;font-weight:700;color:var(--dark)}.opt2 p{font-size:12px;color:var(--muted)}
.btn{display:block;width:100%;max-width:360px;margin:24px auto 0;padding:18px;border:none;border-radius:14px;font-size:18px;font-weight:700;font-family:var(--sans);cursor:pointer;transition:all .15s;letter-spacing:.3px}
.btn:active{transform:scale(.97)}.btn-primary{background:var(--bx);color:#fff}.btn-primary:disabled{opacity:.3;cursor:not-allowed;transform:none}
.btn-ghost{background:none;color:var(--muted);font-size:14px;font-weight:500;margin-top:12px}
.btn-outline{background:none;border:2px solid var(--bx);color:var(--bx)}

/* Nav */
.nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);padding:8px 0 env(safe-area-inset-bottom,10px);z-index:200;display:none}
.nav.on{display:block}
.nav-in{max-width:500px;margin:0 auto;display:flex;justify-content:space-around}
.nb{display:flex;flex-direction:column;align-items:center;gap:3px;border:none;background:none;cursor:pointer;padding:6px 4px;color:var(--muted);font-size:10px;font-weight:600;font-family:var(--sans);transition:color .2s;min-width:52px}
.nb .ni{font-size:22px;line-height:1;transition:transform .2s}.nb.on{color:var(--bx)}.nb.on .ni{transform:scale(1.15)}

.box{max-width:480px;margin:0 auto;padding:0 20px}

/* Hero card */
.hero{background:var(--dark);color:#fff;border-radius:var(--r);padding:28px 24px;margin:20px 0 16px;text-align:center;position:relative;overflow:hidden}
.hero::after{content:'';position:absolute;top:-40px;right:-40px;width:140px;height:140px;border-radius:50%;background:rgba(200,16,46,.12)}
.hero-label{font-size:12px;text-transform:uppercase;letter-spacing:2.5px;color:rgba(255,255,255,.45);margin-bottom:8px;font-weight:600}
.hero-big{font-size:72px;font-weight:700;line-height:1;letter-spacing:-3px}
.hero-unit{font-size:22px;color:var(--bx);font-weight:600;margin-left:2px}
.hero-detail{font-size:14px;color:rgba(255,255,255,.55);margin-top:8px}

/* Phase indicator */
.phase-track{display:flex;gap:4px;margin:16px 0;padding:0 4px}
.phase-dot{flex:1;height:6px;border-radius:3px;background:var(--border);transition:background .3s}
.phase-dot.done{background:var(--green)}.phase-dot.active{background:var(--bx)}

.phase-card{background:var(--card);border-radius:var(--r);padding:20px;margin:12px 0;box-shadow:var(--sh);position:relative;overflow:hidden}
.phase-card.green{border-left:4px solid var(--green)}
.phase-card.orange{border-left:4px solid var(--orange)}
.phase-card.bx{border-left:4px solid var(--bx)}
.phase-card.blue{border-left:4px solid var(--blue)}
.phase-card.purple{border-left:4px solid var(--purple)}
.pc-tag{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px}
.pc-tag.green{color:var(--green)}.pc-tag.orange{color:var(--orange)}.pc-tag.bx{color:var(--bx)}.pc-tag.blue{color:var(--blue)}.pc-tag.purple{color:var(--purple)}
.pc-title{font-size:20px;font-weight:700;color:var(--dark);margin-bottom:4px}
.pc-desc{font-size:14px;color:var(--body);line-height:1.5}

/* Progress */
.prog{margin:16px 0 8px}.prog-bar{background:var(--border);border-radius:8px;height:8px;overflow:hidden}
.prog-fill{height:100%;border-radius:8px;transition:width .6s ease}
.prog-labels{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px;font-weight:500}

/* Info cards */
.info-card{background:var(--card);border-radius:var(--r);padding:20px;margin:12px 0;box-shadow:var(--sh)}
.info-card h3{font-size:16px;font-weight:700;color:var(--dark);margin-bottom:8px;display:flex;align-items:center;gap:8px}
.info-card p{font-size:14px;color:var(--body);line-height:1.6}

/* Diet tabs */
.dtabs{display:flex;gap:8px;padding:16px 0 12px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.dtabs::-webkit-scrollbar{display:none}
.dtab{flex-shrink:0;padding:10px 18px;border-radius:24px;border:2px solid var(--border);background:var(--card);font-size:14px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .2s;white-space:nowrap}
.dtab.on{background:var(--bx);border-color:var(--bx);color:#fff}

/* Food items */
.food-section{margin:12px 0}
.food-section h4{font-size:14px;font-weight:700;color:var(--dark);margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.food-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}
.food-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--card);border-radius:12px;box-shadow:var(--sh);font-size:13px;color:var(--dark);font-weight:500}
.food-item.yes{border-left:3px solid var(--green)}.food-item.no{border-left:3px solid var(--red);opacity:.7}
.food-item.maybe{border-left:3px solid var(--orange)}
.fi-ico{font-size:20px;flex-shrink:0}

/* Tracker */
.tracker{background:var(--card);border-radius:var(--r);padding:20px;margin:12px 0;box-shadow:var(--sh)}
.tracker h3{font-size:15px;font-weight:700;color:var(--dark);margin-bottom:12px;display:flex;align-items:center;justify-content:space-between}
.tracker h3 span{font-size:14px;font-weight:600;color:var(--bx)}
.track-bar{background:var(--border);border-radius:8px;height:10px;overflow:hidden;margin-bottom:10px}
.track-fill{height:100%;border-radius:8px;transition:width .4s ease}
.track-btns{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.track-btn{width:48px;height:48px;border-radius:12px;border:2px solid var(--border);background:var(--card);font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s}
.track-btn.done{background:var(--bx-l);border-color:var(--bx)}
.track-btn:active{transform:scale(.93)}

/* Tasks */
.task{display:flex;align-items:flex-start;gap:14px;background:var(--card);border-radius:14px;padding:16px;margin:8px 0;box-shadow:var(--sh);cursor:pointer;transition:all .2s}
.task:active{transform:scale(.99)}
.tck{width:28px;height:28px;border:2.5px solid var(--border);border-radius:8px;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:16px;margin-top:1px}
.task.done .tck{background:var(--green);border-color:var(--green);color:#fff}.task.done{opacity:.6}
.t-body{flex:1}.t-body h4{font-size:15px;font-weight:600;color:var(--dark);line-height:1.3}.t-body p{font-size:13px;color:var(--muted);margin-top:3px;line-height:1.4}

/* Search */
.search-wrap{position:relative;margin:12px 0}
.search-wrap input{width:100%;padding:14px 16px 14px 44px;border:2px solid var(--border);border-radius:14px;font-size:16px;font-family:var(--sans);color:var(--dark);background:var(--card);appearance:none}
.search-wrap input:focus{outline:none;border-color:var(--bx)}
.search-wrap::before{content:'ğŸ”';position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:18px}

/* Alert banner */
.alert{background:var(--red-l);border:2px solid var(--red);border-radius:var(--r);padding:16px 20px;margin:12px 0}
.alert h4{font-size:15px;font-weight:700;color:var(--red);margin-bottom:4px}.alert p{font-size:13px;color:var(--body);line-height:1.5}
.alert-green{background:var(--green-l);border-color:var(--green)}.alert-green h4{color:var(--green)}
.alert-orange{background:var(--orange-l);border-color:var(--orange)}.alert-orange h4{color:var(--orange)}

/* Emergency btn */
.emer-btn{display:flex;align-items:center;justify-content:center;gap:12px;background:var(--red);color:#fff;border:none;border-radius:var(--r);padding:20px;margin:16px 0;width:100%;font-size:20px;font-weight:700;font-family:var(--sans);cursor:pointer;transition:all .15s}
.emer-btn:active{transform:scale(.97)}

/* Vitamin table */
.vtable{width:100%;border-collapse:collapse;font-size:13px;margin:12px 0}
.vtable th{text-align:left;padding:10px 8px;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);border-bottom:2px solid var(--dark);font-weight:600}
.vtable td{padding:10px 8px;border-bottom:1px solid var(--border);vertical-align:top}
.vtable td:first-child{font-weight:600;color:var(--dark)}

/* Follow-up timeline */
.timeline{position:relative;padding-left:24px;margin:16px 0}
.timeline::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:var(--border)}
.tl-item{position:relative;margin:16px 0;padding-left:20px}
.tl-item::before{content:'';position:absolute;left:-20px;top:6px;width:14px;height:14px;border-radius:50%;background:var(--bx);border:3px solid var(--light)}
.tl-item.done::before{background:var(--green)}
.tl-item h4{font-size:14px;font-weight:700;color:var(--dark)}.tl-item p{font-size:13px;color:var(--muted);margin-top:2px}

/* Section title */
.sec-title{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--bx);margin:20px 0 10px;padding-top:8px}

/* Kvkk */
.kvkk{font-size:10px;color:var(--muted);text-align:center;margin:16px 0 8px;line-height:1.5}

/* Weight log */
.weight-entry{display:flex;gap:8px;margin:8px 0}
.weight-entry input{flex:1;padding:12px;border:2px solid var(--border);border-radius:12px;font-size:16px;font-family:var(--sans);color:var(--dark);background:var(--card);text-align:center}
.weight-entry input:focus{outline:none;border-color:var(--bx)}
.weight-entry button{padding:12px 20px;border:none;border-radius:12px;background:var(--bx);color:#fff;font-size:16px;font-weight:700;font-family:var(--sans);cursor:pointer}

/* Scrollbar hide */
::-webkit-scrollbar{width:0;height:0}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â• WIZARD â•â•â•â•â•â•â• -->
<div id="wizard" class="scr on">
<div class="wiz">

  <!-- Step 0: Welcome -->
  <div class="wiz-step on" data-step="0">
    <div class="wiz-emoji">âš•ï¸</div>
    <h2>ESG Rehberim</h2>
    <p class="wiz-sub">Endoskopik Sleeve Gastroplasti iÅŸleminiz iÃ§in hazÄ±rlÄ±k ve sonrasÄ± takip rehberiniz.</p>
    <p class="wiz-sub" style="font-size:14px;color:var(--bx);font-weight:600">DoÃ§. Dr. Cem ÅimÅŸek<br>Bariatrik Endoskopi</p>
    <button class="btn btn-primary" onclick="wizNext(1)">BaÅŸlayalÄ±m</button>
  </div>

  <!-- Step 1: TC Kimlik -->
  <div class="wiz-step" data-step="1">
    <div class="wiz-emoji">ğŸ”</div>
    <h2>Kimlik DoÄŸrulama</h2>
    <p class="wiz-sub">TC Kimlik numaranÄ±zÄ± girin. Verileriniz sadece bu cihazda gÃ¼venli olarak saklanÄ±r.</p>
    <input type="tel" class="wiz-input" id="tcInput" placeholder="TC Kimlik No (11 hane)" maxlength="11" inputmode="numeric" oninput="validateTC()">
    <button class="btn btn-primary" id="tcBtn" disabled onclick="wizSetTC()">DoÄŸrula</button>
    <p class="kvkk">ğŸ”’ KVKK kapsamÄ±nda verileriniz yalnÄ±zca bu cihazda saklanÄ±r, sunucuya gÃ¶nderilmez.</p>
  </div>

  <!-- Step 2: Date -->
  <div class="wiz-step" data-step="2">
    <div class="wiz-emoji">ğŸ“…</div>
    <h2>Ä°ÅŸlem Tarihiniz</h2>
    <p class="wiz-sub">Endoskopik Sleeve Gastroplasti iÅŸleminiz ne zaman?</p>
    <input type="date" class="wiz-input" id="dateInput" onchange="validateDate()">
    <button class="btn btn-primary" id="dateBtn" disabled onclick="wizNext(3)">Devam</button>
  </div>

  <!-- Step 3: Time -->
  <div class="wiz-step" data-step="3">
    <div class="wiz-emoji">ğŸ•</div>
    <h2>Ä°ÅŸlem Saati</h2>
    <p class="wiz-sub">Ä°ÅŸleminiz sabah mÄ± Ã¶ÄŸleden sonra mÄ±?</p>
    <div class="opts2">
      <div class="opt2" onclick="selTime('morning',this)"><div class="o2-ico">ğŸŒ…</div><h3>Sabah</h3><p>08:00 â€“ 12:00</p></div>
      <div class="opt2" onclick="selTime('afternoon',this)"><div class="o2-ico">ğŸŒ‡</div><h3>Ã–ÄŸleden Sonra</h3><p>13:00 â€“ 17:00</p></div>
    </div>
    <button class="btn btn-primary" id="timeBtn" disabled onclick="wizFinish()">Rehberi BaÅŸlat</button>
  </div>

</div>
</div>

<!-- â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â• -->

<!-- HOME -->
<div id="s-home" class="scr">
<div class="box">
  <div id="homeHero" class="hero">
    <div class="hero-label" id="heroLabel">Ä°ÅLEME KALAN</div>
    <div class="hero-big" id="heroBig">--</div>
    <div class="hero-detail" id="heroDetail"></div>
  </div>

  <div id="phaseTrack" class="phase-track"></div>

  <div id="currentPhase"></div>

  <div id="homeCards"></div>

  <div class="info-card" style="text-align:center;margin-top:20px">
    <p style="font-size:13px;color:var(--muted)">DoÃ§. Dr. Cem ÅimÅŸek Â· Bariatrik Endoskopi</p>
    <button class="btn btn-ghost" onclick="resetApp()" style="margin-top:8px;font-size:12px">âš™ï¸ AyarlarÄ± SÄ±fÄ±rla</button>
  </div>
</div>
</div>

<!-- DIET -->
<div id="s-diet" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">ğŸ½ï¸ Beslenme Rehberi</div>

  <div id="dietPhaseTabs" class="dtabs"></div>

  <div id="dietContent"></div>

  <div class="sec-title">ğŸ” Bu Yenilir Mi?</div>
  <div class="search-wrap">
    <input type="text" id="foodSearch" placeholder="Yiyecek ara... (Ã¶rn: yoÄŸurt)" oninput="searchFood()">
  </div>
  <div id="foodResults"></div>
</div>
</div>

<!-- TRACKING -->
<div id="s-track" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">ğŸ’§ GÃ¼nlÃ¼k Takip</div>

  <div id="proteinTracker" class="tracker">
    <h3>ğŸ¥© Protein <span id="proteinCount">0 / 60 g</span></h3>
    <div class="track-bar"><div class="track-fill" id="proteinFill" style="width:0%;background:var(--bx)"></div></div>
    <div class="track-btns" id="proteinBtns"></div>
  </div>

  <div id="hydrationTracker" class="tracker">
    <h3>ğŸ’§ SÄ±vÄ± AlÄ±mÄ± <span id="hydroCount">0 / 2000 ml</span></h3>
    <div class="track-bar"><div class="track-fill" id="hydroFill" style="width:0%;background:linear-gradient(90deg,#4FC3F7,#0288D1)"></div></div>
    <div class="track-btns" id="hydroBtns"></div>
  </div>

  <div class="sec-title">âš–ï¸ Kilo Takibi</div>
  <div class="weight-entry">
    <input type="number" id="weightInput" placeholder="kg" step="0.1" min="30" max="300">
    <button onclick="logWeight()">Kaydet</button>
  </div>
  <div id="weightLog"></div>
</div>
</div>

<!-- TASKS -->
<div id="s-tasks" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">âœ… Kontrol Listesi</div>
  <div id="tasksList"></div>
</div>
</div>

<!-- INFO -->
<div id="s-info" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">ğŸ“‹ Bilgi & Acil</div>

  <a href="tel:112" class="emer-btn" style="text-decoration:none">ğŸš¨ ACÄ°L DURUM â€” 112'yi Ara</a>

  <div class="alert">
    <h4>âš ï¸ Acil â€” Hemen BaÅŸvurun</h4>
    <p>â€¢ Åiddetli, artan karÄ±n aÄŸrÄ±sÄ±<br>â€¢ 38.5Â°C Ã¼zeri ateÅŸ<br>â€¢ SÃ¼rekli kusma (sÄ±vÄ± tutamama)<br>â€¢ KanlÄ± kusma / kanlÄ±-siyah dÄ±ÅŸkÄ±<br>â€¢ GÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± / nefes darlÄ±ÄŸÄ±</p>
  </div>

  <div class="alert alert-green">
    <h4>âœ… Normal (Beklenen) Belirtiler</h4>
    <p>â€¢ Hafif-orta karÄ±n aÄŸrÄ±sÄ± (3â€“5 gÃ¼n)<br>â€¢ BulantÄ± (ilk 2â€“3 gÃ¼n)<br>â€¢ BoÄŸaz aÄŸrÄ±sÄ± (1â€“2 gÃ¼n)<br>â€¢ Gaz, ÅŸiÅŸkinlik, omuz aÄŸrÄ±sÄ±<br>â€¢ Halsizlik (ilk hafta)</p>
  </div>

  <div class="sec-title">ğŸ’Š Vitamin & Takviye</div>
  <div class="info-card">
    <table class="vtable">
      <tr><th>Takviye</th><th>Doz</th><th>BaÅŸlangÄ±Ã§</th></tr>
      <tr><td>Multivitamin</td><td>1â€“2 tablet/gÃ¼n (Ã§iÄŸneme)</td><td>2. hafta</td></tr>
      <tr><td>Kalsiyum + D</td><td>1200â€“1500mg + 3000 IU</td><td>2. hafta</td></tr>
      <tr><td>B12</td><td>1000 mcg/gÃ¼n oral</td><td>2. hafta</td></tr>
      <tr><td>PPI (Mide koruyucu)</td><td>Doktor reÃ§etesiyle</td><td>Hemen</td></tr>
    </table>
  </div>

  <div class="sec-title">ğŸ“… Takip RandevularÄ±</div>
  <div class="info-card">
    <div class="timeline" id="followupTimeline"></div>
  </div>

  <div class="sec-title">âš ï¸ GLP-1 Ä°laÃ§ UyarÄ±sÄ±</div>
  <div class="alert alert-orange">
    <h4>Ozempic, Wegovy, Mounjaro, Saxenda...</h4>
    <p>GLP-1 agonistleri mide boÅŸalmasÄ±nÄ± yavaÅŸlatÄ±r. Anestezi sÄ±rasÄ±nda aspirasyon riski oluÅŸturur. <strong>Ä°ÅŸlemden en az 1â€“3 hafta Ã¶nce</strong> doktorunuzla gÃ¶rÃ¼ÅŸerek kesilmelidir.</p>
  </div>

  <div class="sec-title">ğŸ“ Ä°letiÅŸim</div>
  <div class="info-card">
    <h3>ğŸ‘¨â€âš•ï¸ DoÃ§. Dr. Cem ÅimÅŸek</h3>
    <p>Bariatrik Endoskopi / Gastroenteroloji<br>
    ğŸ“± <a href="tel:+905342964684" style="color:var(--bx);font-weight:600">0534 296 46 84</a><br>
    <span style="font-size:12px;color:var(--muted)">Sorun durumunda 7/24 ulaÅŸÄ±labilir</span></p>
  </div>

  <div class="info-card" style="text-align:center">
    <p style="font-size:11px;color:var(--muted)">Bu rehber gÃ¼ncel uluslararasÄ± kÄ±lavuzlara dayanmaktadÄ±r.<br>ASMBS 2025 Â· IFSO 2024 Â· ASGE/ESGE Â· NICE IPG783<br>Doktorunuzun size Ã¶zel talimatlarÄ±na uyunuz.</p>
  </div>
</div>
</div>

<!-- NAV -->
<div id="nav" class="nav">
<div class="nav-in">
  <button class="nb on" onclick="go('home')"><span class="ni">ğŸ </span>Ana Sayfa</button>
  <button class="nb" onclick="go('diet')"><span class="ni">ğŸ½ï¸</span>Beslenme</button>
  <button class="nb" onclick="go('track')"><span class="ni">ğŸ’§</span>Takip</button>
  <button class="nb" onclick="go('tasks')"><span class="ni">âœ…</span>GÃ¶revler</button>
  <button class="nb" onclick="go('info')"><span class="ni">â„¹ï¸</span>Bilgi</button>
</div>
</div>

<script>
// â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•

const PHASES = [
  {id:'pre2w', name:'Ä°ÅŸlem Ã–ncesi Diyet', tag:'2 Hafta Ã–nce', color:'purple', dayRange:[-14,-3],
   desc:'DÃ¼ÅŸÃ¼k kalorili, yÃ¼ksek proteinli diyet ile karaciÄŸer yaÄŸlanmasÄ±nÄ± azaltÄ±n.'},
  {id:'pre3d', name:'SÄ±vÄ± Diyet', tag:'Son 2-3 GÃ¼n', color:'orange', dayRange:[-3,-1],
   desc:'Tamamen sÄ±vÄ± diyete geÃ§in: su, berrak et suyu, protein shake, sade Ã§ay.'},
  {id:'npo', name:'AÃ§lÄ±k (NPO)', tag:'Ä°ÅŸlem GÃ¼nÃ¼', color:'bx', dayRange:[0,0],
   desc:'Gece yarÄ±sÄ±ndan itibaren hiÃ§bir ÅŸey yemeyin/iÃ§meyin. RefakatÃ§i zorunludur.'},
  {id:'phase1', name:'Berrak SÄ±vÄ±', tag:'Faz 1 Â· 0â€“3. GÃ¼n', color:'blue', dayRange:[0,3],
   desc:'Hidrasyon odaklÄ±. 15 dk\'da 30-60 ml kÃ¼Ã§Ã¼k yudumlar. GÃ¼nde 1.5-2 litre.'},
  {id:'phase2', name:'Tam SÄ±vÄ± + Protein', tag:'Faz 2 Â· 3â€“14. GÃ¼n', color:'green', dayRange:[3,14],
   desc:'GÃ¼nde 60-90g protein + 2+ litre sÄ±vÄ±. GÃ¼nde 2-3 protein shake.'},
  {id:'phase3', name:'YumuÅŸak GÄ±da', tag:'Faz 3 Â· 2â€“4. Hafta', color:'orange', dayRange:[14,28],
   desc:'Ã‡atalla ezilecek kÄ±vam. Ã–nce proteini yiyin! 3 kÃ¼Ã§Ã¼k Ã¶ÄŸÃ¼n + 1 atÄ±ÅŸtÄ±rmalÄ±k.'},
  {id:'phase4', name:'Normal SaÄŸlÄ±klÄ± Diyet', tag:'Faz 4 Â· 4. Hafta+', color:'bx', dayRange:[28,9999],
   desc:'Ã–nce protein â†’ sonra sebze â†’ en son karbonhidrat. YaÅŸam boyu kurallar.'},
];

// ESG Diet Food Database (phase-based)
const FOODS = {
  pre2w: {
    yes:[ ['ğŸ—','Tavuk, balÄ±k, hindi (Ä±zgara)'],['ğŸ¥š','Yumurta'],['ğŸ§€','Lor/sÃ¼zme peynir'],['ğŸ¥›','YaÄŸsÄ±z yoÄŸurt'],
          ['ğŸ¥¦','TÃ¼m sebzeler (piÅŸmiÅŸ/Ã§iÄŸ)'],['ğŸ','Tam tahÄ±l ekmek (1-2 dilim)'],['ğŸ’§','Bol su (2.5+ lt/gÃ¼n)'],['ğŸ«˜','Baklagiller (az)'] ],
    no:[ ['ğŸŒ­','Ä°ÅŸlenmiÅŸ et (sucuk, salam)'],['ğŸ•','Beyaz ekmek, makarna, bÃ¶rek, pizza'],['ğŸ«','Åekerli gÄ±dalar, Ã§ikolata'],
         ['ğŸ¥¤','GazlÄ± iÃ§ecekler'],['ğŸŸ','KÄ±zartÄ±lmÄ±ÅŸ/yaÄŸlÄ± gÄ±dalar'],['ğŸº','Alkol'],['ğŸ”','Fast-food, hazÄ±r gÄ±dalar'] ]
  },
  pre3d: {
    yes:[ ['ğŸ’§','Su'],['ğŸµ','Sade Ã§ay (kafeinsiz)'],['ğŸ²','Berrak et/tavuk suyu'],['ğŸ¥¤','SÃ¼zÃ¼lmÃ¼ÅŸ Ã§orba'],
          ['ğŸ§‹','Protein shake'],['ğŸ§ƒ','SÃ¼zÃ¼lmÃ¼ÅŸ elma suyu'] ],
    no:[ ['ğŸ–','TÃ¼m katÄ± gÄ±dalar'],['â˜•','Kafeinli iÃ§ecekler'],['ğŸ¥›','SÃ¼t Ã¼rÃ¼nleri'],['ğŸ§ƒ','PosalÄ± meyve sularÄ±'] ]
  },
  phase1: {
    yes:[ ['ğŸ’§','Su'],['ğŸµ','Sade Ã§ay (kafeinsiz)'],['ğŸ²','Berrak et/tavuk suyu'],['ğŸ®','Åekersiz jelatin'],
          ['ğŸ§ƒ','SÃ¼zÃ¼lmÃ¼ÅŸ elma suyu (berrak)'],['ğŸ§‹','Berrak protein iÃ§eceÄŸi'] ],
    no:[ ['ğŸ–','TÃ¼m katÄ± gÄ±dalar'],['â˜•','Kafein'],['ğŸ¥›','SÃ¼t Ã¼rÃ¼nleri'],['ğŸ¥¤','GazlÄ± iÃ§ecekler'],
         ['ğŸ§ƒ','PosalÄ± sÄ±vÄ±lar'],['ğŸ¥¤','Pipet kullanmayÄ±n'] ]
  },
  phase2: {
    yes:[ ['ğŸ§‹','Protein shake (20-30g)'],['ğŸ²','SÃ¼zÃ¼lmÃ¼ÅŸ Ã§orbalar'],['ğŸ¥›','YaÄŸsÄ±z sÃ¼t'],['ğŸ¥£','Sade yoÄŸurt'],
          ['ğŸ§ƒ','Ayran'],['ğŸ’§','Su (2+ lt/gÃ¼n)'],['ğŸµ','Sade Ã§ay'],['ğŸ²','Berrak et suyu'] ],
    no:[ ['ğŸ–','KatÄ± gÄ±dalar'],['ğŸŸ','YaÄŸlÄ± gÄ±dalar'],['ğŸ¥¤','GazlÄ± iÃ§ecekler'],['ğŸ«','Åekerli gÄ±dalar'],
         ['â˜•','Fazla kafein'],['ğŸ¥¤','Pipet kullanmayÄ±n'] ]
  },
  phase3: {
    yes:[ ['ğŸ¥š','Yumurta (rafadan/omlet)'],['ğŸŸ','YumuÅŸak balÄ±k, ton konserve'],['ğŸ¥©','Ä°nce kÄ±yma'],['ğŸ§€','Lor peyniri'],
          ['ğŸƒ','Kabak, havuÃ§, patates ezmesi'],['ğŸ¥‘','Avokado, muz (ezme)'],['ğŸ','Elma pÃ¼resi, komposto'],
          ['ğŸ«˜','Mercimek ezmesi, humus'],['ğŸ§€','Krem peynir (az yaÄŸlÄ±)'],['ğŸ','YumuÅŸak makarna (az)'] ],
    no:[ ['ğŸ¥–','Sert ekmek, kuru gÄ±dalar'],['ğŸ¥©','Sert/lifli et'],['ğŸŒ½','Ã‡iÄŸ sebzeler'],['ğŸŸ','KÄ±zartmalar'],
         ['ğŸ¥¤','GazlÄ± iÃ§ecekler'],['ğŸ«','Åekerli gÄ±dalar'],['ğŸŒ¶ï¸','BaharatlÄ± gÄ±dalar'] ]
  },
  phase4: {
    yes:[ ['ğŸ—','Tavuk, hindi (Ä±zgara/haÅŸlama)'],['ğŸŸ','BalÄ±k'],['ğŸ¥š','Yumurta'],['ğŸ§€','Peynir (az yaÄŸlÄ±)'],
          ['ğŸ«˜','Baklagiller'],['ğŸ¥¦','TÃ¼m sebzeler'],['ğŸ','Meyveler'],['ğŸ','Tam tahÄ±l (az miktar)'],
          ['ğŸ’§','2+ litre su/gÃ¼n'],['ğŸ¥—','Salata'] ],
    no:[ ['ğŸ¥¤','GazlÄ± iÃ§ecekler (YAÅAM BOYU)'],['ğŸ«','Åekerli gÄ±dalar/iÃ§ecekler'],['ğŸ”','Fast-food'],
         ['ğŸŸ','KÄ±zartmalar'],['ğŸº','Alkol (ilk 6-12 ay)'],['ğŸ¿','SÃ¼rekli atÄ±ÅŸtÄ±rma'] ]
  }
};

// Tasks per phase
const TASKS = {
  pre2w: [
    {t:'Kan tahlillerimi yaptÄ±rdÄ±m', d:'Tam kan, KC/bÃ¶brek, tiroid, HbA1c, lipid, demir, B12, D vit.'},
    {t:'Anestezi deÄŸerlendirmesi tamamlandÄ±', d:'Ã–n deÄŸerlendirme, EKG, akciÄŸer grafisi'},
    {t:'Diyetisyen gÃ¶rÃ¼ÅŸmesini yaptÄ±m', d:'Beslenme alÄ±ÅŸkanlÄ±klarÄ±, vitamin dÃ¼zeyleri'},
    {t:'2 haftalÄ±k diyete baÅŸladÄ±m', d:'DÃ¼ÅŸÃ¼k kalorili, yÃ¼ksek proteinli'},
    {t:'Ä°laÃ§larÄ±mÄ± doktorumla gÃ¶zden geÃ§irdim', d:'Kan sulandÄ±rÄ±cÄ±lar, diyabet ilaÃ§larÄ±'},
    {t:'GLP-1 ilacÄ±m varsa kesildi', d:'Ozempic, Wegovy, Mounjaro â€” 1-3 hafta Ã¶nce'},
    {t:'NSAÄ°D kesildi (7 gÃ¼n Ã¶nce)', d:'Ä°buprofen, Naproksen â†’ Parasetamol kullanÄ±labilir'},
    {t:'Sigara bÄ±rakma sÃ¼recinde', d:'En az 4 hafta Ã¶nce bÄ±rakÄ±n'},
    {t:'Alkol kesildi (2 hafta Ã¶nce)', d:''},
    {t:'Protein shake ve vitaminleri aldÄ±m', d:'Ä°ÅŸlem sonrasÄ± iÃ§in hazÄ±rlÄ±k'},
    {t:'YumuÅŸak gÄ±da malzemeleri aldÄ±m', d:'Faz 3 iÃ§in Ã¶nceden hazÄ±rlÄ±k'},
    {t:'RefakatÃ§im hazÄ±r', d:'Ä°ÅŸlem gÃ¼nÃ¼ zorunlu'},
  ],
  pre3d: [
    {t:'Tamamen sÄ±vÄ± diyete geÃ§tim', d:'Su, berrak et suyu, protein shake, sade Ã§ay'},
    {t:'Protein shake iÃ§meye devam', d:'GÃ¼nde 2-3 protein shake'},
    {t:'Bol su iÃ§iyorum', d:'GÃ¼nde 2+ litre'},
    {t:'NPO kuralÄ±nÄ± biliyorum', d:'Gece yarÄ±sÄ±ndan itibaren aÃ§ kalacaÄŸÄ±m'},
  ],
  npo: [
    {t:'Gece yarÄ±sÄ±ndan beri aÃ§', d:'HiÃ§bir ÅŸey yemeyin/iÃ§meyin'},
    {t:'OnaylÄ± ilaÃ§larÄ± az su ile aldÄ±m', d:'Doktor onayÄ± ile'},
    {t:'RefakatÃ§im benimle', d:'Ä°ÅŸlem sonrasÄ± eve gÃ¶tÃ¼recek'},
    {t:'Rahat kÄ±yafet giydim', d:''},
  ],
  phase1: [
    {t:'15 dk\'da 30-60 ml su yudumladÄ±m', d:'KÃ¼Ã§Ã¼k yudumlar, yavaÅŸÃ§a'},
    {t:'Berrak et suyu/tavuk suyu iÃ§tim', d:''},
    {t:'SÄ±vÄ± alÄ±mÄ±mÄ± kaydettim', d:'GÃ¼nde 1.5-2 litre hedefi'},
    {t:'Ä°laÃ§larÄ±mÄ± aldÄ±m', d:'PPI + reÃ§eteli ilaÃ§lar'},
    {t:'Pipet kullanmadÄ±m', d:'Gaz yapabilir'},
    {t:'YÃ¼rÃ¼yÃ¼ÅŸ yaptÄ±m (5-10 dk)', d:'Ev iÃ§i kÄ±sa yÃ¼rÃ¼yÃ¼ÅŸler'},
  ],
  phase2: [
    {t:'Protein shake iÃ§tim (2-3 adet)', d:'Her biri 20-30g protein'},
    {t:'Toplam 60g protein hedefine ulaÅŸtÄ±m', d:''},
    {t:'2+ litre sÄ±vÄ± aldÄ±m', d:'Protein shake dahil deÄŸil'},
    {t:'Vitamin takviyesine baÅŸladÄ±m', d:'Multivitamin + Kalsiyum + D + B12'},
    {t:'YÃ¼rÃ¼yÃ¼ÅŸ sÃ¼resini artÄ±rdÄ±m', d:'20-30 dakika'},
  ],
  phase3: [
    {t:'Ã–nce proteini yedim', d:'Her Ã¶ÄŸÃ¼nde ilk protein'},
    {t:'Ã‡atalla ezilecek kÄ±vamda yedim', d:'YumuÅŸak gÄ±dalar'},
    {t:'3 kÃ¼Ã§Ã¼k Ã¶ÄŸÃ¼n + 1 atÄ±ÅŸtÄ±rmalÄ±k', d:'Her Ã¶ÄŸÃ¼n 15-20 dk'},
    {t:'YavaÅŸ Ã§iÄŸnedim (20+ kez)', d:''},
    {t:'Tok olunca durdum', d:'Fazla yemeyin'},
    {t:'Vitaminlerimi aldÄ±m', d:''},
    {t:'Protein shake devam (gÃ¼nde 1)', d:''},
  ],
  phase4: [
    {t:'Protein â†’ Sebze â†’ Karbonhidrat sÄ±rasÄ±', d:'Her Ã¶ÄŸÃ¼nde bu sÄ±rayÄ± takip edin'},
    {t:'Ã‡ay tabaÄŸÄ± boyutu porsiyon', d:'KÃ¼Ã§Ã¼k porsiyonlar'},
    {t:'Yemekle iÃ§meyi ayÄ±rdÄ±m', d:'15 dk Ã¶nce bÄ±rak, 30 dk sonra baÅŸla'},
    {t:'2+ litre su iÃ§tim (Ã¶ÄŸÃ¼n arasÄ±)', d:''},
    {t:'Vitaminlerimi aldÄ±m', d:''},
    {t:'Egzersiz yaptÄ±m (150+ dk/hafta)', d:'YÃ¼rÃ¼yÃ¼ÅŸ, bisiklet, yÃ¼zme'},
    {t:'Yemek gÃ¼nlÃ¼ÄŸÃ¼ tuttum', d:''},
    {t:'GazlÄ± iÃ§ecek iÃ§medim', d:'YaÅŸam boyu yasak'},
  ],
};

const FOLLOWUP = [
  {time:'1. Hafta', desc:'Telefon/online â€” iyileÅŸme, sÄ±vÄ± alÄ±mÄ±, ilaÃ§ uyumu'},
  {time:'2. Hafta', desc:'Muayene â€” yumuÅŸak gÄ±daya geÃ§iÅŸ, vitamin baÅŸlangÄ±cÄ±'},
  {time:'1. Ay', desc:'Diyetisyen â€” normal diyete geÃ§iÅŸ, kilo takibi'},
  {time:'3. Ay', desc:'Kan tahlili â€” vitamin dÃ¼zeyleri, kilo deÄŸerlendirmesi'},
  {time:'6. Ay', desc:'KapsamlÄ± kontrol â€” metabolik parametreler'},
  {time:'12. Ay', desc:'YÄ±llÄ±k â€” endoskopi (gerekirse), uzun vadeli plan'},
];

// â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•
const SK = 'esgrehber1';
let S = {};
function load(){ try{S=JSON.parse(localStorage.getItem(SK))||{}}catch(e){S={}} }
function save(){ localStorage.setItem(SK, JSON.stringify(S)) }

// â•â•â•â•â•â•â• TC VALIDATION â•â•â•â•â•â•â•
function validateTC(){
  const v = tcInput.value.replace(/\D/g,'');
  tcInput.value = v;
  tcBtn.disabled = !isValidTC(v);
}
function isValidTC(tc){
  if(tc.length!==11||tc[0]==='0') return false;
  const d=tc.split('').map(Number);
  const s10=((d[0]+d[2]+d[4]+d[6]+d[8])*7-(d[1]+d[3]+d[5]+d[7]))%10;
  if(s10!==d[9]) return false;
  let sum=0; for(let i=0;i<10;i++) sum+=d[i];
  return sum%10===d[10];
}
async function hashTC(tc){
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(tc));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
async function wizSetTC(){
  const tc = tcInput.value;
  if(!isValidTC(tc)) return;
  const h = await hashTC(tc);
  // Check existing
  const allKeys = Object.keys(localStorage).filter(k=>k.startsWith(SK+'_'));
  let found = null;
  for(const k of allKeys){
    try{const d=JSON.parse(localStorage.getItem(k)); if(d&&d.tch===h){found=k;break;}}catch(e){}
  }
  if(found){
    S = JSON.parse(localStorage.getItem(found));
    S._key = found;
    save2();
    localStorage.setItem(SK+'_current', found);
    startApp();
    return;
  }
  S = {tch:h, created:Date.now()};
  const key = SK+'_'+Date.now();
  S._key = key;
  localStorage.setItem(key, JSON.stringify(S));
  localStorage.setItem(SK+'_current', key);
  wizNext(2);
}
function save2(){
  if(S._key) localStorage.setItem(S._key, JSON.stringify(S));
}

// â•â•â•â•â•â•â• WIZARD â•â•â•â•â•â•â•
function wizNext(step){
  document.querySelectorAll('.wiz-step').forEach(s=>s.classList.remove('on'));
  document.querySelector(`.wiz-step[data-step="${step}"]`).classList.add('on');
}
function validateDate(){ dateBtn.disabled = !dateInput.value; }
let selTimeVal = null;
function selTime(val, el){
  selTimeVal = val;
  document.querySelectorAll('.opt2').forEach(o=>o.classList.remove('sel'));
  el.classList.add('sel');
  timeBtn.disabled = false;
}
function wizFinish(){
  S.procDate = dateInput.value;
  S.procTime = selTimeVal;
  save2();
  startApp();
}

// â•â•â•â•â•â•â• APP START â•â•â•â•â•â•â•
function startApp(){
  document.getElementById('wizard').classList.remove('on');
  document.getElementById('nav').classList.add('on');
  go('home');
}

// â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•
function go(tab){
  document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));
  document.getElementById('s-'+tab).classList.add('on');
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('on'));
  document.querySelectorAll('.nb').forEach(b=>{ if(b.textContent.trim().includes(getTabLabel(tab))) b.classList.add('on'); });
  if(tab==='home') renderHome();
  if(tab==='diet') renderDiet();
  if(tab==='track') renderTrack();
  if(tab==='tasks') renderTasks();
  if(tab==='info') renderInfo();
  window.scrollTo(0,0);
}
function getTabLabel(t){
  return {home:'Ana Sayfa',diet:'Beslenme',track:'Takip',tasks:'GÃ¶revler',info:'Bilgi'}[t]||'';
}

// â•â•â•â•â•â•â• PHASE LOGIC â•â•â•â•â•â•â•
function getDaysSinceProc(){
  if(!S.procDate) return null;
  const proc = new Date(S.procDate+'T00:00:00');
  const now = new Date();
  now.setHours(0,0,0,0);
  return Math.floor((now - proc)/(1000*60*60*24));
}
function getCurrentPhase(){
  const days = getDaysSinceProc();
  if(days===null) return PHASES[0];
  // Pre-procedure phases
  if(days < -14) return PHASES[0]; // pre2w
  if(days < -3) return PHASES[0]; // pre2w
  if(days < 0) return PHASES[1]; // pre3d
  if(days === 0) return PHASES[2]; // npo (procedure day)
  if(days <= 3) return PHASES[3]; // phase1
  if(days <= 14) return PHASES[4]; // phase2
  if(days <= 28) return PHASES[5]; // phase3
  return PHASES[6]; // phase4
}

// â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•
function renderHome(){
  const days = getDaysSinceProc();
  const phase = getCurrentPhase();
  const heroLabel = document.getElementById('heroLabel');
  const heroBig = document.getElementById('heroBig');
  const heroDetail = document.getElementById('heroDetail');

  if(days === null || days < 0){
    // Pre-procedure
    const remaining = Math.abs(days || 0);
    heroLabel.textContent = 'Ä°ÅLEME KALAN';
    heroBig.innerHTML = remaining + '<span class="hero-unit">gÃ¼n</span>';
    const procDateObj = new Date(S.procDate+'T00:00:00');
    heroDetail.textContent = procDateObj.toLocaleDateString('tr-TR',{weekday:'long',day:'numeric',month:'long',year:'numeric'}) + ' Â· ' + (S.procTime==='morning'?'Sabah':'Ã–ÄŸleden Sonra');
  } else {
    // Post-procedure
    heroLabel.textContent = 'Ä°ÅLEMDEN BU YANA';
    heroBig.innerHTML = days + '<span class="hero-unit">gÃ¼n</span>';
    heroDetail.textContent = phase.name + ' Â· ' + phase.tag;
  }

  // Phase track
  const track = document.getElementById('phaseTrack');
  track.innerHTML = PHASES.map((p,i)=>{
    const pi = PHASES.indexOf(phase);
    const cls = i < pi ? 'done' : i === pi ? 'active' : '';
    return `<div class="phase-dot ${cls}"></div>`;
  }).join('');

  // Current phase card
  const cp = document.getElementById('currentPhase');
  cp.innerHTML = `
    <div class="phase-card ${phase.color}">
      <div class="pc-tag ${phase.color}">${phase.tag}</div>
      <div class="pc-title">${phase.name}</div>
      <div class="pc-desc">${phase.desc}</div>
    </div>`;

  // Home cards
  const cards = document.getElementById('homeCards');
  let html = '';

  if(days !== null && days < 0 && days >= -14){
    // Pre-procedure diet progress
    const totalDays = 14;
    const elapsed = 14 + days; // days from start of 2-week diet
    const pct = Math.min(100, Math.round(elapsed/totalDays*100));
    html += `<div class="info-card">
      <h3>ğŸ¥— Ä°ÅŸlem Ã–ncesi Diyet Ä°lerlemesi</h3>
      <div class="prog"><div class="prog-bar"><div class="prog-fill" style="width:${pct}%;background:var(--bx)"></div></div>
      <div class="prog-labels"><span>${elapsed}. gÃ¼n</span><span>${totalDays} gÃ¼n</span></div></div>
    </div>`;
  }

  if(days !== null && days >= 0){
    // Post-procedure: protein and hydration summary
    const today = todayKey();
    const protein = (S.protein && S.protein[today]) || 0;
    const hydro = (S.hydration && S.hydration[today]) || 0;
    const pGoal = days <= 3 ? 0 : 60;
    const hGoal = days <= 3 ? 1500 : 2000;
    html += `<div class="info-card">
      <h3>ğŸ¥© BugÃ¼nkÃ¼ Protein</h3>
      <div class="prog"><div class="prog-bar"><div class="prog-fill" style="width:${pGoal?Math.min(100,protein/pGoal*100):0}%;background:var(--bx)"></div></div>
      <div class="prog-labels"><span>${protein}g</span><span>${pGoal}g</span></div></div>
    </div>`;
    html += `<div class="info-card">
      <h3>ğŸ’§ BugÃ¼nkÃ¼ SÄ±vÄ±</h3>
      <div class="prog"><div class="prog-bar"><div class="prog-fill" style="width:${Math.min(100,hydro/hGoal*100)}%;background:linear-gradient(90deg,#4FC3F7,#0288D1)"></div></div>
      <div class="prog-labels"><span>${hydro} ml</span><span>${hGoal} ml</span></div></div>
    </div>`;
  }

  // Key rule for current phase
  const rules = {
    pre2w: 'ğŸ¯ Protein hedefi: gÃ¼nde 60-80g. KaraciÄŸer yaÄŸlanmasÄ±nÄ± azaltmak kritik!',
    pre3d: 'âš ï¸ Sadece berrak sÄ±vÄ±lar! KatÄ± gÄ±da yok. Bol su iÃ§in.',
    npo: 'ğŸš« Gece yarÄ±sÄ±ndan itibaren hiÃ§bir ÅŸey yemeyin/iÃ§meyin!',
    phase1: 'ğŸ’§ KÃ¼Ã§Ã¼k yudumlar: 15 dk\'da 30-60 ml. Pipet kullanmayÄ±n!',
    phase2: 'ğŸ§‹ GÃ¼nde 2-3 protein shake. Vitamin takviyesine baÅŸlayÄ±n!',
    phase3: 'ğŸ½ï¸ Ã‡atalla ezilecek kÄ±vam. HER Ã–ÄÃœNDE Ã–NCE PROTEÄ°N!',
    phase4: 'ğŸ“ Protein â†’ Sebze â†’ Karbonhidrat. Ã‡ay tabaÄŸÄ± boyutu porsiyon.',
  };
  if(rules[phase.id]){
    html += `<div class="alert alert-orange"><h4>ğŸ“Œ GÃ¼nÃ¼n KuralÄ±</h4><p>${rules[phase.id]}</p></div>`;
  }

  cards.innerHTML = html;
}

// â•â•â•â•â•â•â• DIET â•â•â•â•â•â•â•
let dietPhaseIdx = null;
function renderDiet(){
  const phase = getCurrentPhase();
  const tabs = document.getElementById('dietPhaseTabs');

  // Show relevant phases as tabs
  const days = getDaysSinceProc() || -15;
  let relevantPhases;
  if(days < 0){
    relevantPhases = PHASES.slice(0,2); // pre2w, pre3d
  } else {
    relevantPhases = PHASES.slice(3); // phase1-4
  }

  if(dietPhaseIdx === null){
    dietPhaseIdx = PHASES.indexOf(phase);
    if(!relevantPhases.includes(PHASES[dietPhaseIdx])) dietPhaseIdx = PHASES.indexOf(relevantPhases[0]);
  }

  tabs.innerHTML = relevantPhases.map((p,i)=>{
    const active = PHASES.indexOf(p) === dietPhaseIdx ? 'on' : '';
    return `<div class="dtab ${active}" onclick="setDietPhase(${PHASES.indexOf(p)})">${p.name}</div>`;
  }).join('');

  renderDietContent();
}
function setDietPhase(idx){
  dietPhaseIdx = idx;
  renderDiet();
}
function renderDietContent(){
  const phase = PHASES[dietPhaseIdx];
  const el = document.getElementById('dietContent');
  const foods = FOODS[phase.id] || FOODS.phase4;

  let html = `<div class="phase-card ${phase.color}" style="margin-bottom:16px">
    <div class="pc-tag ${phase.color}">${phase.tag}</div>
    <div class="pc-title">${phase.name}</div>
    <div class="pc-desc">${phase.desc}</div>
  </div>`;

  // Allowed foods
  if(foods.yes && foods.yes.length){
    html += `<div class="food-section"><h4 style="color:var(--green)">âœ… TÃ¼ketebilecekleriniz</h4><div class="food-grid">`;
    foods.yes.forEach(f=>{ html += `<div class="food-item yes"><span class="fi-ico">${f[0]}</span>${f[1]}</div>`; });
    html += `</div></div>`;
  }

  // Forbidden foods
  if(foods.no && foods.no.length){
    html += `<div class="food-section"><h4 style="color:var(--red)">ğŸš« KaÃ§Ä±nmanÄ±z Gerekenler</h4><div class="food-grid">`;
    foods.no.forEach(f=>{ html += `<div class="food-item no"><span class="fi-ico">${f[0]}</span>${f[1]}</div>`; });
    html += `</div></div>`;
  }

  // Phase-specific tips
  const tips = {
    pre2w: `<div class="alert alert-orange"><h4>ğŸ’¡ Ä°pucu</h4><p>Her Ã¶ÄŸÃ¼nde tabaÄŸÄ±nÄ±zÄ±n yarÄ±sÄ±nÄ± proteinle doldurun. Sebzeleri bol tÃ¼ketin. Bol su iÃ§in â€” gÃ¼nde en az 2.5 litre.</p></div>`,
    pre3d: `<div class="alert alert-orange"><h4>ğŸ’¡ Ä°pucu</h4><p>Protein shake'lerinizi iÃ§meye devam edin. Berrak Ã§orbalar (sÃ¼zÃ¼lmÃ¼ÅŸ) ve bol su. AÃ§lÄ±k hissederseniz berrak et suyu yudumlayin.</p></div>`,
    phase1: `<div class="alert alert-orange"><h4>ğŸ’¡ Ä°pucu</h4><p>1 ons (30ml) Ã¶lÃ§Ã¼m kabÄ± kullanÄ±n, 5 dk'da 1 yudum. Saatte 150 ml aÅŸmayÄ±n. YavaÅŸÃ§a yudumlayin, tok hissedince durun.</p></div>`,
    phase2: `<div class="info-card"><h3>ğŸ“‹ Ã–rnek GÃ¼nlÃ¼k Plan</h3><p>
      <strong>08:00</strong> Protein shake (20-30g)<br>
      <strong>10:00</strong> Su veya dÃ¼ÅŸÃ¼k kalorili iÃ§ecek<br>
      <strong>12:00</strong> Protein shake<br>
      <strong>14:00</strong> SÃ¼zÃ¼lmÃ¼ÅŸ Ã§orba + su<br>
      <strong>16:00</strong> Protein shake<br>
      <strong>18:00</strong> Sade yoÄŸurt + ayran<br>
      <strong>20:00</strong> Su veya berrak Ã§ay</p></div>`,
    phase3: `<div class="info-card"><h3>ğŸ“‹ Yemek KurallarÄ±</h3><p>
      â€¢ <strong>Ã–nce protein</strong> â€” her Ã¶ÄŸÃ¼nde ilk Ã¶nce proteini yiyin<br>
      â€¢ <strong>YavaÅŸ Ã§iÄŸneyin</strong> â€” her lokmayÄ± 20+ kez Ã§iÄŸneyin<br>
      â€¢ <strong>15-20 dk Ã¶ÄŸÃ¼n</strong> â€” acele etmeyin<br>
      â€¢ <strong>Tok olunca durun</strong> â€” fazla zorlamayÄ±n<br>
      â€¢ GÃ¼nde 1 protein shake devam<br>
      â€¢ SÄ±vÄ±larÄ± yemekten ayrÄ± iÃ§in</p></div>`,
    phase4: `<div class="info-card"><h3>ğŸ“ SaÄŸlÄ±klÄ± Tabak Modeli</h3><p style="text-align:center;font-size:16px;margin:8px 0">
      <span style="display:inline-block;background:var(--dark);color:var(--bx);padding:12px 20px;border-radius:10px;font-weight:700">Â½ PROTEÄ°N</span>
      <span style="display:inline-block;background:var(--green-l);color:var(--green);padding:12px 14px;border-radius:10px;font-weight:700">Â¼ SEBZE</span>
      <span style="display:inline-block;background:var(--orange-l);color:var(--orange);padding:12px 14px;border-radius:10px;font-weight:700">Â¼ KARBONHÄ°DRAT</span>
      </p><p style="font-size:13px;color:var(--muted);text-align:center">Protein: Tavuk, balÄ±k, yumurta, lor, baklagil<br>Sebze: Renkli, lifli sebzeler<br>Karbonhidrat: Tam tahÄ±l, az miktarda</p></div>`,
  };
  if(tips[phase.id]) html += tips[phase.id];

  // Liquid separation rule
  if(['phase3','phase4'].includes(phase.id)){
    html += `<div class="alert alert-orange"><h4>ğŸš° SÄ±vÄ± KuralÄ±</h4><p>Yemekten <strong>15 dk Ã¶nce</strong> sÄ±vÄ±larÄ± bÄ±rakÄ±n. Yemek bittikten <strong>30 dk sonra</strong> tekrar su iÃ§meye baÅŸlayÄ±n. Yemek sÄ±rasÄ±nda su iÃ§mek mideyi aÅŸÄ±rÄ± doldurabilir.</p></div>`;
  }

  el.innerHTML = html;
}

// Food search
function searchFood(){
  const q = document.getElementById('foodSearch').value.toLowerCase().trim();
  const el = document.getElementById('foodResults');
  if(!q || q.length < 2){ el.innerHTML=''; return; }

  const phase = getCurrentPhase();
  const foods = FOODS[phase.id] || FOODS.phase4;
  let results = [];

  if(foods.yes) foods.yes.forEach(f=>{
    if(f[1].toLowerCase().includes(q)) results.push({...f, type:'yes'});
  });
  if(foods.no) foods.no.forEach(f=>{
    if(f[1].toLowerCase().includes(q)) results.push({...f, type:'no'});
  });

  // Also search all phases if no result
  if(!results.length){
    Object.entries(FOODS).forEach(([pid,fd])=>{
      if(fd.yes) fd.yes.forEach(f=>{
        if(f[1].toLowerCase().includes(q)) results.push({ico:f[0],txt:f[1],type:'yes',phase:pid});
      });
      if(fd.no) fd.no.forEach(f=>{
        if(f[1].toLowerCase().includes(q)) results.push({ico:f[0],txt:f[1],type:'no',phase:pid});
      });
    });
  }

  if(!results.length){
    el.innerHTML = `<div class="info-card"><p style="text-align:center">SonuÃ§ bulunamadÄ±. Doktorunuza danÄ±ÅŸÄ±n.</p></div>`;
    return;
  }

  el.innerHTML = results.map(r=>{
    const ico = r[0] || r.ico || 'ğŸ½ï¸';
    const txt = r[1] || r.txt || '';
    const note = r.phase ? ` <span style="font-size:11px;color:var(--muted)">(${PHASES.find(p=>p.id===r.phase)?.name||r.phase})</span>` : '';
    return `<div class="food-item ${r.type}"><span class="fi-ico">${ico}</span>${txt}${note}</div>`;
  }).join('');
}

// â•â•â•â•â•â•â• TRACKING â•â•â•â•â•â•â•
function todayKey(){ return new Date().toISOString().slice(0,10); }

function renderTrack(){
  const days = getDaysSinceProc() || -15;
  const today = todayKey();

  // Protein
  if(!S.protein) S.protein = {};
  const protein = S.protein[today] || 0;
  const pGoal = days >= 3 ? 60 : (days >= 0 ? 0 : 60);
  document.getElementById('proteinCount').textContent = `${protein} / ${pGoal} g`;
  document.getElementById('proteinFill').style.width = pGoal ? Math.min(100,protein/pGoal*100)+'%' : '0%';

  const pBtns = document.getElementById('proteinBtns');
  pBtns.innerHTML = [10,15,20,25,30].map(v=>`<div class="track-btn" onclick="addProtein(${v})">${v}g</div>`).join('');

  // Hydration
  if(!S.hydration) S.hydration = {};
  const hydro = S.hydration[today] || 0;
  const hGoal = days >= 0 && days <= 3 ? 1500 : 2000;
  document.getElementById('hydroCount').textContent = `${hydro} / ${hGoal} ml`;
  document.getElementById('hydroFill').style.width = Math.min(100,hydro/hGoal*100)+'%';

  const hBtns = document.getElementById('hydroBtns');
  hBtns.innerHTML = [30,60,100,150,200,250].map(v=>`<div class="track-btn" onclick="addHydro(${v})">${v>=1000?(v/1000)+'L':v}</div>`).join('');

  // Weight log
  renderWeightLog();
}
function addProtein(g){
  const today = todayKey();
  if(!S.protein) S.protein = {};
  S.protein[today] = (S.protein[today]||0) + g;
  save2(); renderTrack();
}
function addHydro(ml){
  const today = todayKey();
  if(!S.hydration) S.hydration = {};
  S.hydration[today] = (S.hydration[today]||0) + ml;
  save2(); renderTrack();
}
function logWeight(){
  const w = parseFloat(document.getElementById('weightInput').value);
  if(!w || w < 30 || w > 300) return;
  if(!S.weights) S.weights = [];
  S.weights.push({date:todayKey(), kg:w});
  save2();
  document.getElementById('weightInput').value = '';
  renderWeightLog();
}
function renderWeightLog(){
  const el = document.getElementById('weightLog');
  if(!S.weights || !S.weights.length){ el.innerHTML='<p style="font-size:13px;color:var(--muted);text-align:center;margin-top:8px">HenÃ¼z kayÄ±t yok</p>'; return; }
  const recent = S.weights.slice(-10).reverse();
  el.innerHTML = recent.map(w=>`<div class="info-card" style="padding:12px 16px;margin:6px 0;display:flex;justify-content:space-between;align-items:center">
    <span style="font-size:13px;color:var(--muted)">${new Date(w.date).toLocaleDateString('tr-TR')}</span>
    <span style="font-size:18px;font-weight:700;color:var(--dark)">${w.kg} kg</span>
  </div>`).join('');

  if(S.weights.length >= 2){
    const first = S.weights[0].kg;
    const last = S.weights[S.weights.length-1].kg;
    const diff = (last - first).toFixed(1);
    const color = diff < 0 ? 'var(--green)' : diff > 0 ? 'var(--red)' : 'var(--muted)';
    el.innerHTML = `<div style="text-align:center;margin:8px 0"><span style="font-size:14px;font-weight:700;color:${color}">${diff > 0 ? '+' : ''}${diff} kg toplam deÄŸiÅŸim</span></div>` + el.innerHTML;
  }
}

// â•â•â•â•â•â•â• TASKS â•â•â•â•â•â•â•
function renderTasks(){
  const phase = getCurrentPhase();
  const tasks = TASKS[phase.id] || TASKS.phase4;
  const today = todayKey();
  if(!S.tasks) S.tasks = {};
  if(!S.tasks[today]) S.tasks[today] = {};

  const el = document.getElementById('tasksList');
  const done = Object.values(S.tasks[today]).filter(v=>v).length;
  const total = tasks.length;
  const pct = Math.round(done/total*100);

  let html = `<div class="phase-card ${phase.color}" style="margin-bottom:12px">
    <div class="pc-tag ${phase.color}">${phase.tag}</div>
    <div class="pc-title">${phase.name} GÃ¶revleri</div>
    <div class="prog" style="margin-top:8px"><div class="prog-bar"><div class="prog-fill" style="width:${pct}%;background:var(--green)"></div></div>
    <div class="prog-labels"><span>${done} / ${total} tamamlandÄ±</span><span>${pct}%</span></div></div>
  </div>`;

  tasks.forEach((t,i)=>{
    const isDone = S.tasks[today][i];
    html += `<div class="task ${isDone?'done':''}" onclick="toggleTask(${i})">
      <div class="tck">${isDone?'âœ“':''}</div>
      <div class="t-body"><h4>${t.t}</h4>${t.d?`<p>${t.d}</p>`:''}</div>
    </div>`;
  });

  el.innerHTML = html;
}
function toggleTask(i){
  const today = todayKey();
  if(!S.tasks) S.tasks = {};
  if(!S.tasks[today]) S.tasks[today] = {};
  S.tasks[today][i] = !S.tasks[today][i];
  save2(); renderTasks();
}

// â•â•â•â•â•â•â• INFO â•â•â•â•â•â•â•
function renderInfo(){
  const el = document.getElementById('followupTimeline');
  const days = getDaysSinceProc() || -15;
  el.innerHTML = FOLLOWUP.map((f,i)=>{
    // Simple "done" check based on days
    const doneThresholds = [7,14,30,90,180,365];
    const isDone = days >= doneThresholds[i];
    return `<div class="tl-item ${isDone?'done':''}"><h4>${f.time}</h4><p>${f.desc}</p></div>`;
  }).join('');
}

// â•â•â•â•â•â•â• RESET â•â•â•â•â•â•â•
function resetApp(){
  if(!confirm('TÃ¼m verileriniz silinecek. Emin misiniz?')) return;
  const currentKey = localStorage.getItem(SK+'_current');
  if(currentKey) localStorage.removeItem(currentKey);
  localStorage.removeItem(SK+'_current');
  S = {};
  location.reload();
}

// â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•
function init(){
  const currentKey = localStorage.getItem(SK+'_current');
  if(currentKey){
    try{
      S = JSON.parse(localStorage.getItem(currentKey)) || {};
      S._key = currentKey;
      if(S.procDate){
        startApp();
        return;
      }
    }catch(e){}
  }
  document.getElementById('wizard').classList.add('on');
}

init();
</script>
</body>
</html>
