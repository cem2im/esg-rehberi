<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#C8102E">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš•ï¸</text></svg>">
<title>ESG Rehberim â€” HazÄ±rlÄ±k & Takip</title>
<style>
:root{--bx:#C8102E;--bx-l:rgba(200,16,46,.08);--bx-m:rgba(200,16,46,.15);--dark:#1a1a1a;--body:#444;--muted:#999;--light:#f5f4f2;--card:#fff;--border:#e8e6e3;--green:#1a8d4e;--green-l:rgba(26,141,78,.08);--orange:#e67e22;--orange-l:rgba(230,126,34,.08);--red:#c0392b;--red-l:rgba(192,57,43,.08);--blue:#2980b9;--blue-l:rgba(41,128,185,.08);--purple:#8e44ad;--purple-l:rgba(142,68,173,.08);--sans:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;--r:16px;--sh:0 2px 16px rgba(0,0,0,.06)}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;-webkit-text-size-adjust:100%;scroll-behavior:smooth}
body{font-family:var(--sans);color:var(--body);background:var(--light);line-height:1.5;min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
.scr{display:none;min-height:100dvh;padding-bottom:100px}.scr.on{display:block;animation:up .35s ease}
@keyframes up{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

/* Wizard */
.wiz{min-height:100dvh;display:flex;flex-direction:column;justify-content:center;padding:32px 24px;text-align:center}
.wiz-step{display:none}.wiz-step.on{display:block;animation:up .3s ease}
.wiz-emoji{font-size:64px;margin-bottom:16px}
.wiz h2{font-size:26px;font-weight:700;color:var(--dark);line-height:1.3;margin-bottom:8px}
.wiz p.wiz-sub{font-size:16px;color:var(--muted);margin-bottom:24px;line-height:1.5}
.wiz-input{width:100%;padding:18px 20px;border:2px solid var(--border);border-radius:14px;font-size:20px;font-family:var(--sans);color:var(--dark);background:var(--card);text-align:center;appearance:none;-webkit-appearance:none}
.wiz-input:focus{outline:none;border-color:var(--bx)}
.btn{display:block;width:100%;max-width:360px;margin:16px auto 0;padding:18px;border:none;border-radius:14px;font-size:18px;font-weight:700;font-family:var(--sans);cursor:pointer;transition:all .15s;letter-spacing:.3px}
.btn:active{transform:scale(.97)}.btn-primary{background:var(--bx);color:#fff}.btn-primary:disabled{opacity:.3;cursor:not-allowed;transform:none}
.btn-ghost{background:none;color:var(--muted);font-size:14px;font-weight:500;margin-top:8px}
.btn-outline{background:none;border:2px solid var(--bx);color:var(--bx);font-weight:600}
.btn-white{background:var(--card);border:2px solid var(--border);color:var(--dark);font-weight:600}

/* How-to cards */
.howto{max-width:360px;margin:0 auto;text-align:left}
.howto-item{display:flex;gap:14px;margin:14px 0;align-items:flex-start}
.howto-num{width:36px;height:36px;border-radius:50%;background:var(--bx);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:16px;flex-shrink:0}
.howto-body h4{font-size:15px;font-weight:700;color:var(--dark)}.howto-body p{font-size:13px;color:var(--muted);margin-top:2px}

/* Nav */
.nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);padding:8px 0 env(safe-area-inset-bottom,10px);z-index:200;display:none}
.nav.on{display:block}
.nav-in{max-width:500px;margin:0 auto;display:flex;justify-content:space-around}
.nb{display:flex;flex-direction:column;align-items:center;gap:3px;border:none;background:none;cursor:pointer;padding:6px 4px;color:var(--muted);font-size:10px;font-weight:600;font-family:var(--sans);transition:color .2s;min-width:52px}
.nb .ni{font-size:22px;line-height:1;transition:transform .2s}.nb.on{color:var(--bx)}.nb.on .ni{transform:scale(1.15)}

.box{max-width:480px;margin:0 auto;padding:0 20px}

/* Hero */
.hero{background:var(--dark);color:#fff;border-radius:var(--r);padding:24px;margin:20px 0 16px;text-align:center;position:relative;overflow:hidden}
.hero::after{content:'';position:absolute;top:-40px;right:-40px;width:140px;height:140px;border-radius:50%;background:rgba(200,16,46,.12)}
.hero-label{font-size:12px;text-transform:uppercase;letter-spacing:2.5px;color:rgba(255,255,255,.45);margin-bottom:6px;font-weight:600}
.hero-big{font-size:64px;font-weight:700;line-height:1;letter-spacing:-3px}
.hero-unit{font-size:20px;color:var(--bx);font-weight:600;margin-left:2px}
.hero-detail{font-size:14px;color:rgba(255,255,255,.55);margin-top:8px}
.hero-small{font-size:18px;font-weight:600;line-height:1.4}

/* Phase cards */
.phase-track{display:flex;gap:4px;margin:16px 0;padding:0 4px}
.phase-dot{flex:1;height:6px;border-radius:3px;background:var(--border);transition:background .3s}
.phase-dot.done{background:var(--green)}.phase-dot.active{background:var(--bx)}

.phase-card{background:var(--card);border-radius:var(--r);padding:20px;margin:12px 0;box-shadow:var(--sh);position:relative;overflow:hidden;cursor:pointer;transition:all .2s}
.phase-card:active{transform:scale(.99)}
.phase-card.green{border-left:4px solid var(--green)}
.phase-card.orange{border-left:4px solid var(--orange)}
.phase-card.bx{border-left:4px solid var(--bx)}
.phase-card.blue{border-left:4px solid var(--blue)}
.phase-card.purple{border-left:4px solid var(--purple)}
.phase-card.active-glow{box-shadow:0 0 0 2px var(--bx),var(--sh)}
.pc-tag{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px}
.pc-tag.green{color:var(--green)}.pc-tag.orange{color:var(--orange)}.pc-tag.bx{color:var(--bx)}.pc-tag.blue{color:var(--blue)}.pc-tag.purple{color:var(--purple)}
.pc-title{font-size:18px;font-weight:700;color:var(--dark);margin-bottom:4px}
.pc-desc{font-size:13px;color:var(--body);line-height:1.5}
.pc-badge{position:absolute;top:12px;right:12px;background:var(--bx);color:#fff;font-size:10px;font-weight:700;padding:4px 10px;border-radius:20px;text-transform:uppercase;letter-spacing:1px}

/* Info cards */
.info-card{background:var(--card);border-radius:var(--r);padding:20px;margin:12px 0;box-shadow:var(--sh)}
.info-card h3{font-size:16px;font-weight:700;color:var(--dark);margin-bottom:8px;display:flex;align-items:center;gap:8px}
.info-card p{font-size:14px;color:var(--body);line-height:1.6}

/* Food items */
.food-section{margin:12px 0}
.food-section h4{font-size:14px;font-weight:700;color:var(--dark);margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.food-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}
.food-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--card);border-radius:12px;box-shadow:var(--sh);font-size:13px;color:var(--dark);font-weight:500}
.food-item.yes{border-left:3px solid var(--green)}.food-item.no{border-left:3px solid var(--red);opacity:.7}
.fi-ico{font-size:20px;flex-shrink:0}

/* Tracker */
.tracker{background:var(--card);border-radius:var(--r);padding:20px;margin:12px 0;box-shadow:var(--sh)}
.tracker h3{font-size:15px;font-weight:700;color:var(--dark);margin-bottom:12px;display:flex;align-items:center;justify-content:space-between}
.tracker h3 span{font-size:14px;font-weight:600;color:var(--bx)}
.track-bar{background:var(--border);border-radius:8px;height:10px;overflow:hidden;margin-bottom:10px}
.track-fill{height:100%;border-radius:8px;transition:width .4s ease}
.track-btns{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.track-btn{min-width:48px;height:44px;border-radius:12px;border:2px solid var(--border);background:var(--card);font-size:15px;font-weight:600;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;padding:0 10px;color:var(--dark)}
.track-btn:active{transform:scale(.93);background:var(--bx-l);border-color:var(--bx)}

/* Tasks */
.task{display:flex;align-items:flex-start;gap:14px;background:var(--card);border-radius:14px;padding:16px;margin:8px 0;box-shadow:var(--sh);cursor:pointer;transition:all .2s}
.task:active{transform:scale(.99)}
.tck{width:28px;height:28px;border:2.5px solid var(--border);border-radius:8px;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:16px;margin-top:1px}
.task.done .tck{background:var(--green);border-color:var(--green);color:#fff}.task.done{opacity:.6}
.t-body{flex:1}.t-body h4{font-size:15px;font-weight:600;color:var(--dark);line-height:1.3}.t-body p{font-size:13px;color:var(--muted);margin-top:3px;line-height:1.4}

/* Search */
.search-wrap{position:relative;margin:12px 0}
.search-wrap input{width:100%;padding:14px 16px 14px 44px;border:2px solid var(--border);border-radius:14px;font-size:16px;font-family:var(--sans);color:var(--dark);background:var(--card);appearance:none}
.search-wrap input:focus{outline:none;border-color:var(--bx)}
.search-wrap::before{content:'ğŸ”';position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:18px}

/* Alert */
.alert{background:var(--red-l);border:2px solid var(--red);border-radius:var(--r);padding:16px 20px;margin:12px 0}
.alert h4{font-size:15px;font-weight:700;color:var(--red);margin-bottom:4px}.alert p{font-size:13px;color:var(--body);line-height:1.5}
.alert-green{background:var(--green-l);border-color:var(--green)}.alert-green h4{color:var(--green)}
.alert-orange{background:var(--orange-l);border-color:var(--orange)}.alert-orange h4{color:var(--orange)}

/* Emergency */
.emer-btn{display:flex;align-items:center;justify-content:center;gap:12px;background:var(--red);color:#fff;border:none;border-radius:var(--r);padding:20px;margin:16px 0;width:100%;font-size:20px;font-weight:700;font-family:var(--sans);cursor:pointer;transition:all .15s;text-decoration:none}
.emer-btn:active{transform:scale(.97)}

/* Contact buttons */
.contact-btns{display:flex;gap:10px;margin:12px 0}
.contact-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:16px;border-radius:var(--r);font-size:15px;font-weight:700;font-family:var(--sans);text-decoration:none;transition:all .15s}
.contact-btn:active{transform:scale(.97)}
.contact-btn.tg{background:#0088cc;color:#fff}
.contact-btn.wa{background:#25D366;color:#fff}

/* Vitamin table */
.vtable{width:100%;border-collapse:collapse;font-size:13px;margin:12px 0}
.vtable th{text-align:left;padding:10px 8px;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);border-bottom:2px solid var(--dark);font-weight:600}
.vtable td{padding:10px 8px;border-bottom:1px solid var(--border);vertical-align:top}
.vtable td:first-child{font-weight:600;color:var(--dark)}

/* Timeline */
.timeline{position:relative;padding-left:24px;margin:16px 0}
.timeline::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:var(--border)}
.tl-item{position:relative;margin:16px 0;padding-left:20px}
.tl-item::before{content:'';position:absolute;left:-20px;top:6px;width:14px;height:14px;border-radius:50%;background:var(--bx);border:3px solid var(--light)}
.tl-item.done::before{background:var(--green)}
.tl-item h4{font-size:14px;font-weight:700;color:var(--dark)}.tl-item p{font-size:13px;color:var(--muted);margin-top:2px}

/* Section */
.sec-title{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--bx);margin:20px 0 10px;padding-top:8px}

/* Weight entry */
.measure-row{display:flex;gap:8px;margin:8px 0;align-items:center}
.measure-row label{font-size:13px;font-weight:600;color:var(--dark);min-width:60px}
.measure-row input{flex:1;padding:12px;border:2px solid var(--border);border-radius:12px;font-size:16px;font-family:var(--sans);color:var(--dark);background:var(--card);text-align:center}
.measure-row input:focus{outline:none;border-color:var(--bx)}
.measure-save{padding:12px 24px;border:none;border-radius:12px;background:var(--bx);color:#fff;font-size:16px;font-weight:700;font-family:var(--sans);cursor:pointer;width:100%;margin-top:8px}

/* Progress */
.prog{margin:12px 0 8px}.prog-bar{background:var(--border);border-radius:8px;height:8px;overflow:hidden}
.prog-fill{height:100%;border-radius:8px;transition:width .6s ease}
.prog-labels{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px;font-weight:500}

/* Date picker in-app */
.date-set{background:var(--card);border-radius:var(--r);padding:20px;margin:12px 0;box-shadow:var(--sh);text-align:center}
.date-set h3{font-size:15px;font-weight:700;color:var(--dark);margin-bottom:8px}
.date-set input{padding:14px;border:2px solid var(--border);border-radius:12px;font-size:16px;font-family:var(--sans);color:var(--dark);background:var(--light);text-align:center;width:100%;max-width:260px}
.date-set input:focus{outline:none;border-color:var(--bx)}

/* Weekly reminder banner */
.reminder-banner{background:var(--bx-l);border:2px solid var(--bx);border-radius:var(--r);padding:16px;margin:12px 0;text-align:center;animation:pulse 2s infinite}
.reminder-banner h4{font-size:15px;font-weight:700;color:var(--bx)}.reminder-banner p{font-size:13px;color:var(--body)}

.kvkk{font-size:10px;color:var(--muted);text-align:center;margin:12px 0;line-height:1.5}
::-webkit-scrollbar{width:0;height:0}

/* Tabs */
.dtabs{display:flex;gap:8px;padding:12px 0;overflow-x:auto;-webkit-overflow-scrolling:touch}
.dtabs::-webkit-scrollbar{display:none}
.dtab{flex-shrink:0;padding:10px 16px;border-radius:24px;border:2px solid var(--border);background:var(--card);font-size:13px;font-weight:600;color:var(--muted);cursor:pointer;transition:all .2s;white-space:nowrap}
.dtab.on{background:var(--bx);border-color:var(--bx);color:#fff}

/* Accordion */
.acc{margin:10px 0}
.acc-item{background:var(--card);border-radius:var(--r);margin:8px 0;box-shadow:var(--sh);overflow:hidden}
.acc-head{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;cursor:pointer;border:none;background:none;width:100%;font-family:var(--sans);text-align:left;transition:background .2s}
.acc-head:active{background:var(--light)}
.acc-head h4{font-size:15px;font-weight:700;color:var(--dark);display:flex;align-items:center;gap:8px;flex:1}
.acc-arrow{font-size:14px;color:var(--muted);transition:transform .3s;flex-shrink:0}
.acc-item.open .acc-arrow{transform:rotate(180deg)}
.acc-body{max-height:0;overflow:hidden;transition:max-height .4s ease}
.acc-item.open .acc-body{max-height:3000px}
.acc-inner{padding:0 20px 20px;font-size:14px;color:var(--body);line-height:1.7}
.acc-inner h5{font-size:14px;font-weight:700;color:var(--dark);margin:14px 0 6px}
.acc-inner ul{padding-left:18px;margin:6px 0}.acc-inner li{margin:4px 0}
.acc-inner .stat-row{display:flex;gap:10px;margin:10px 0;flex-wrap:wrap}
.acc-inner .stat-box{flex:1;min-width:100px;background:var(--light);border-radius:12px;padding:14px;text-align:center}
.acc-inner .stat-box .sn{font-size:26px;font-weight:700;color:var(--bx);line-height:1}
.acc-inner .stat-box .sl{font-size:11px;color:var(--muted);margin-top:4px;text-transform:uppercase;letter-spacing:.5px}
.acc-inner .compare-table{width:100%;border-collapse:collapse;font-size:13px;margin:10px 0}
.acc-inner .compare-table th{text-align:left;padding:8px;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);border-bottom:2px solid var(--dark)}
.acc-inner .compare-table td{padding:8px;border-bottom:1px solid var(--border);vertical-align:top}
.acc-inner .compare-table td:first-child{font-weight:600;color:var(--dark);width:30%}
.dr-card{background:linear-gradient(135deg,var(--dark),#2a2a2a);border-radius:var(--r);padding:24px;color:#fff;margin:12px 0}
.dr-card h3{font-size:18px;font-weight:700;margin-bottom:8px}.dr-card p{font-size:13px;line-height:1.7;color:rgba(255,255,255,.8)}
.dr-card .dr-badges{display:flex;flex-wrap:wrap;gap:6px;margin-top:12px}
.dr-card .dr-badge{background:rgba(200,16,46,.2);color:var(--bx);font-size:11px;font-weight:600;padding:4px 10px;border-radius:20px}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â• WIZARD â•â•â•â•â•â•â• -->
<div id="wizard" class="scr on">
<div class="wiz">

  <!-- Step 0: Welcome -->
  <div class="wiz-step on" data-step="0">
    <div class="wiz-emoji">âš•ï¸</div>
    <h2>ESG Rehberim</h2>
    <p class="wiz-sub">Endoskopik Sleeve Gastroplasti<br>HazÄ±rlÄ±k & Takip Rehberi</p>
    <p style="font-size:14px;color:var(--bx);font-weight:600;margin-bottom:24px">DoÃ§. Dr. Cem ÅimÅŸek<br>Bariatrik Endoskopi</p>
    <button class="btn btn-primary" onclick="wizNext(1)">BaÅŸlayalÄ±m</button>
  </div>

  <!-- Step 1: How to use -->
  <div class="wiz-step" data-step="1">
    <div class="wiz-emoji">ğŸ“–</div>
    <h2>NasÄ±l KullanÄ±lÄ±r?</h2>
    <div class="howto">
      <div class="howto-item"><div class="howto-num">1</div><div class="howto-body"><h4>TC Kimlik ile GiriÅŸ</h4><p>Verileriniz TC kimlik numaranÄ±za baÄŸlÄ± olarak bu cihazda gÃ¼venle saklanÄ±r.</p></div></div>
      <div class="howto-item"><div class="howto-num">2</div><div class="howto-body"><h4>TÃ¼m AÅŸamalarÄ± GÃ¶rÃ¼n</h4><p>Ä°ÅŸlem Ã¶ncesi hazÄ±rlÄ±k, diyet aÅŸamalarÄ±, vitamin ve takip bilgilerine her zaman eriÅŸin.</p></div></div>
      <div class="howto-item"><div class="howto-num">3</div><div class="howto-body"><h4>Ä°ÅŸlem Tarihinizi Girin (Opsiyonel)</h4><p>Tarih girerseniz, bulunduÄŸunuz aÅŸamaya otomatik yÃ¶nlendirilirsiniz.</p></div></div>
      <div class="howto-item"><div class="howto-num">4</div><div class="howto-body"><h4>GÃ¼nlÃ¼k Takip</h4><p>Protein, sÄ±vÄ± alÄ±mÄ±, kilo ve bel Ã§evresi takibi yaparak ilerlemenizi kaydedin.</p></div></div>
      <div class="howto-item"><div class="howto-num">5</div><div class="howto-body"><h4>Doktorunuzla Ä°letiÅŸim</h4><p>SorularÄ±nÄ±z iÃ§in Telegram veya WhatsApp ile doÄŸrudan ulaÅŸÄ±n.</p></div></div>
    </div>
    <button class="btn btn-primary" onclick="wizNext(2)">Devam</button>
  </div>

  <!-- Step 2: TC Kimlik -->
  <div class="wiz-step" data-step="2">
    <div class="wiz-emoji">ğŸ”</div>
    <h2>Kimlik DoÄŸrulama</h2>
    <p class="wiz-sub">TC Kimlik numaranÄ±zÄ± girin.<br>Verileriniz bu cihazda gÃ¼venle saklanÄ±r.</p>
    <input type="tel" class="wiz-input" id="tcInput" placeholder="TC Kimlik No (11 hane)" maxlength="11" inputmode="numeric" oninput="validateTC()">
    <button class="btn btn-primary" id="tcBtn" disabled onclick="wizSetTC()">GiriÅŸ Yap</button>
    <p class="kvkk">ğŸ”’ KVKK kapsamÄ±nda verileriniz yalnÄ±zca bu cihazda saklanÄ±r, sunucuya gÃ¶nderilmez.</p>
  </div>

</div>
</div>

<!-- â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â• -->

<!-- HOME -->
<div id="s-home" class="scr">
<div class="box">
  <div id="homeHero" class="hero"></div>

  <!-- Date setter (optional) -->
  <div class="date-set" id="dateSet">
    <h3>ğŸ“… Ä°ÅŸlem Tarihiniz</h3>
    <p style="font-size:13px;color:var(--muted);margin-bottom:10px">Tarihi girerek bulunduÄŸunuz aÅŸamayÄ± gÃ¶rebilirsiniz (opsiyonel)</p>
    <input type="date" id="procDateInput" onchange="setProcDate()">
    <div id="dateSetInfo" style="margin-top:8px"></div>
  </div>

  <!-- Weekly weight reminder -->
  <div id="weightReminder" style="display:none"></div>

  <!-- Phase overview -->
  <div class="sec-title">ğŸ“‹ AÅŸamalar</div>
  <div id="phaseList"></div>

  <!-- Contact -->
  <div class="sec-title">ğŸ“ Doktorunuza UlaÅŸÄ±n</div>
  <div class="contact-btns">
    <a href="https://t.me/+905316876758" class="contact-btn tg">âœˆï¸ Telegram</a>
    <a href="https://wa.me/905316876758" class="contact-btn wa">ğŸ’¬ WhatsApp</a>
  </div>

  <div class="info-card" style="text-align:center;margin-top:8px">
    <p style="font-size:13px;color:var(--muted)">DoÃ§. Dr. Cem ÅimÅŸek Â· Bariatrik Endoskopi</p>
    <button class="btn btn-ghost" onclick="resetApp()" style="font-size:12px">âš™ï¸ Ã‡Ä±kÄ±ÅŸ / FarklÄ± Hesap</button>
  </div>
</div>
</div>

<!-- DIET -->
<div id="s-diet" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">ğŸ½ï¸ Beslenme Rehberi</div>
  <div id="dietPhaseTabs" class="dtabs"></div>
  <div id="dietContent"></div>

  <div class="sec-title">ğŸ” Bu Yenilir Mi?</div>
  <div class="search-wrap">
    <input type="text" id="foodSearch" placeholder="Yiyecek ara... (Ã¶rn: yoÄŸurt)" oninput="searchFood()">
  </div>
  <div id="foodResults"></div>
</div>
</div>

<!-- TRACKING -->
<div id="s-track" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">ğŸ’§ GÃ¼nlÃ¼k Takip</div>

  <div id="proteinTracker" class="tracker">
    <h3>ğŸ¥© Protein <span id="proteinCount">0 / 60 g</span></h3>
    <div class="track-bar"><div class="track-fill" id="proteinFill" style="width:0%;background:var(--bx)"></div></div>
    <div class="track-btns" id="proteinBtns"></div>
  </div>

  <div id="hydrationTracker" class="tracker">
    <h3>ğŸ’§ SÄ±vÄ± AlÄ±mÄ± <span id="hydroCount">0 / 2000 ml</span></h3>
    <div class="track-bar"><div class="track-fill" id="hydroFill" style="width:0%;background:linear-gradient(90deg,#4FC3F7,#0288D1)"></div></div>
    <div class="track-btns" id="hydroBtns"></div>
  </div>

  <div class="sec-title">âš–ï¸ Kilo & Bel Ã‡evresi Takibi</div>
  <div class="info-card">
    <div class="measure-row"><label>âš–ï¸ Kilo</label><input type="number" id="weightInput" placeholder="kg" step="0.1" min="30" max="300"></div>
    <div class="measure-row"><label>ğŸ“ Bel</label><input type="number" id="waistInput" placeholder="cm (opsiyonel)" step="0.5" min="40" max="250"></div>
    <button class="measure-save" onclick="logMeasure()">Kaydet</button>
  </div>
  <div id="measureLog"></div>
</div>
</div>

<!-- TASKS -->
<div id="s-tasks" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">âœ… Kontrol Listesi</div>
  <div id="taskTabs" class="dtabs"></div>
  <div id="tasksList"></div>
</div>
</div>

<!-- ESG INFO -->
<div id="s-esg" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">âš•ï¸ ESG Nedir?</div>

  <div class="acc" id="esgAccordion">

    <div class="acc-item">
      <button class="acc-head" onclick="toggleAcc(this)">
        <h4>â“ Endoskopik TÃ¼p Mide (ESG) Nedir?</h4><span class="acc-arrow">â–¼</span>
      </button>
      <div class="acc-body"><div class="acc-inner">
        <p>Endoskopik Sleeve Gastroplasti (ESG), mide hacmini <strong>endoskopik yÃ¶ntemlerle kÃ¼Ã§Ã¼lten</strong> cerrahi olmayan bir iÅŸlemdir. Endoskop aÄŸÄ±z yoluyla mideye yerleÅŸtirilir ve mide iÃ§ duvarÄ±nda dikiÅŸ atÄ±larak mide hacmi %70-80 oranÄ±nda azaltÄ±lÄ±r.</p>
        <div class="stat-row">
          <div class="stat-box"><div class="sn">0</div><div class="sl">Cerrahi Kesi</div></div>
          <div class="stat-box"><div class="sn">60</div><div class="sl">Dakika Ä°ÅŸlem</div></div>
          <div class="stat-box"><div class="sn">%70-80</div><div class="sl">Mide KÃ¼Ã§Ã¼ltme</div></div>
        </div>
        <h5>Neden ESG?</h5>
        <ul>
          <li><strong>AmeliyatsÄ±z:</strong> AÄŸÄ±zdan endoskop yoluyla uygulanÄ±r</li>
          <li><strong>Etkili:</strong> Kilo kaybÄ± %15-25 arasÄ±ndadÄ±r</li>
          <li><strong>KalÄ±cÄ±:</strong> Kilo kaybÄ± ve uygulama kalÄ±cÄ±dÄ±r</li>
          <li><strong>Geri DÃ¶ndÃ¼rÃ¼lebilir:</strong> Ä°stenirse dikiÅŸler kesilerek mide eski haline dÃ¶ndÃ¼rÃ¼lebilir</li>
        </ul>
      </div></div>
    </div>

    <div class="acc-item">
      <button class="acc-head" onclick="toggleAcc(this)">
        <h4>ğŸ”¬ ESG NasÄ±l Ã‡alÄ±ÅŸÄ±r?</h4><span class="acc-arrow">â–¼</span>
      </button>
      <div class="acc-body"><div class="acc-inner">
        <h5>Mide Hacmi KÃ¼Ã§Ã¼ltme</h5>
        <p>ESG, endoskopik dikiÅŸlerle mide gÃ¶vdesini daraltarak sleeve (tÃ¼p) ÅŸekli oluÅŸturur. Bu sayede mide daha az yiyecek alabilir ve daha hÄ±zlÄ± tokluk hissi oluÅŸur.</p>
        <h5>Mide BoÅŸalmasÄ±nda Gecikme</h5>
        <p>Ä°ÅŸlem sonrasÄ± mide boÅŸalma hÄ±zÄ± yavaÅŸlar, bu da tokluk sÃ¼resini uzatÄ±r ve kilo kaybÄ±yla gÃ¼Ã§lÃ¼ bir iliÅŸki gÃ¶sterir.</p>
        <h5>Hormonal DeÄŸiÅŸiklikler</h5>
        <p>ESG sonrasÄ± GLP-1 ve PYY (tokluk hormonlarÄ±) seviyeleri artar. Bu benzersiz hormonal profil, ESG'nin uzun vadeli etkinliÄŸine katkÄ±da bulunur. ESG, fundus dokusunu koruduÄŸu iÃ§in bariatrik cerrahiden farklÄ± bir mekanizma ile Ã§alÄ±ÅŸÄ±r.</p>
      </div></div>
    </div>

    <div class="acc-item">
      <button class="acc-head" onclick="toggleAcc(this)">
        <h4>ğŸ“Š Etkinlik ve KalÄ±cÄ±lÄ±k</h4><span class="acc-arrow">â–¼</span>
      </button>
      <div class="acc-body"><div class="acc-inner">
        <div class="stat-row">
          <div class="stat-box"><div class="sn">%15-20</div><div class="sl">Ortalama Kilo KaybÄ±</div></div>
          <div class="stat-box"><div class="sn">5 YÄ±l+</div><div class="sl">KalÄ±cÄ±lÄ±k</div></div>
          <div class="stat-box"><div class="sn">40.000+</div><div class="sl">DÃ¼nyada Uygulama</div></div>
        </div>
        <h5>BaÅŸarÄ±yÄ± Etkileyen FaktÃ¶rler</h5>
        <ul>
          <li>Mide boÅŸalma hÄ±zÄ±ndaki yavaÅŸlama</li>
          <li>SaÄŸlÄ±klÄ± yaÅŸam tarzÄ± alÄ±ÅŸkanlÄ±klarÄ±na uyum</li>
          <li>Ä°ÅŸlem sonrasÄ± beslenme ve egzersiz programÄ±na uyum</li>
          <li>Ä°lk bir aydaki kilo kaybÄ± hÄ±zÄ±</li>
        </ul>
        <p style="margin-top:8px">ESG, intragastrik balon tedavisine kÄ±yasla <strong>daha fazla ve kalÄ±cÄ±</strong> kilo kaybÄ± saÄŸlar. Cerrahi sleeve gastrektomiye yakÄ±n etkinlik gÃ¶sterirken, <strong>Ã§ok daha dÃ¼ÅŸÃ¼k komplikasyon</strong> oranlarÄ±na sahiptir.</p>
        <h5>Komorbiditelerde Ä°yileÅŸme</h5>
        <p>Kilo kaybÄ±na baÄŸlÄ± olarak tip 2 diyabet, hipertansiyon, hiperlipidemi, uyku apnesi gibi hastalÄ±klarda belirgin dÃ¼zelme bildirilmiÅŸtir.</p>
      </div></div>
    </div>

    <div class="acc-item">
      <button class="acc-head" onclick="toggleAcc(this)">
        <h4>ğŸ›¡ï¸ GÃ¼venlik Profili</h4><span class="acc-arrow">â–¼</span>
      </button>
      <div class="acc-body"><div class="acc-inner">
        <div class="stat-row">
          <div class="stat-box"><div class="sn"><%1</div><div class="sl">Ciddi Komplikasyon</div></div>
          <div class="stat-box"><div class="sn">1600+</div><div class="sl">Analiz Edilen Vaka</div></div>
        </div>
        <h5>SÄ±k GÃ¶rÃ¼len Yan Etkiler (GeÃ§ici)</h5>
        <ul>
          <li>BulantÄ± ve kusma: %20-30 (ilk birkaÃ§ gÃ¼n geÃ§er)</li>
          <li>KarÄ±n aÄŸrÄ±sÄ±: ~%45 (24-48 saat iÃ§inde azalÄ±r)</li>
          <li>ÅiÅŸkinlik: %10-15</li>
        </ul>
        <h5>Nadir Ciddi Komplikasyonlar</h5>
        <ul>
          <li>Perigastrik sÄ±vÄ±: <%1 (antibiyotik ile Ã§Ã¶zÃ¼lÃ¼r)</li>
          <li>Kanama: %0.5-1 (endoskopik kontrol)</li>
          <li>Perforasyon: <%0.1 (Ã§ok nadir)</li>
        </ul>
        <p style="margin-top:8px"><strong>KarÅŸÄ±laÅŸtÄ±rma:</strong> Bariatrik cerrahi ciddi komplikasyon oranÄ± %5-10 iken, ESG'de bu oran %1'in altÄ±ndadÄ±r.</p>
      </div></div>
    </div>

    <div class="acc-item">
      <button class="acc-head" onclick="toggleAcc(this)">
        <h4>âš–ï¸ ESG vs Cerrahi TÃ¼p Mide</h4><span class="acc-arrow">â–¼</span>
      </button>
      <div class="acc-body"><div class="acc-inner">
        <table class="compare-table">
          <tr><th>Ã–zellik</th><th>ESG</th><th>Cerrahi</th></tr>
          <tr><td>YÃ¶ntem</td><td>Endoskopik (aÄŸÄ±zdan)</td><td>Laparoskopik (kesi)</td></tr>
          <tr><td>Anestezi</td><td>Genel</td><td>Genel</td></tr>
          <tr><td>SÃ¼re</td><td>60-90 dk</td><td>60-90 dk</td></tr>
          <tr><td>Kilo kaybÄ±</td><td>%15-20</td><td>%20-30</td></tr>
          <tr><td>Komplikasyon</td><td><%1</td><td>%5-10</td></tr>
          <tr><td>Ä°yileÅŸme</td><td>1-3 gÃ¼n</td><td>1-2 hafta</td></tr>
          <tr><td>Geri dÃ¶nÃ¼ÅŸ</td><td>MÃ¼mkÃ¼n</td><td>MÃ¼mkÃ¼n deÄŸil</td></tr>
          <tr><td>Tekrarlanabilir</td><td>Evet</td><td>HayÄ±r</td></tr>
          <tr><td>Mide anatomisi</td><td>Korunur</td><td>DeÄŸiÅŸir</td></tr>
        </table>
        <p style="margin-top:8px">ESG, cerrahi tedaviye alternatif olabileceÄŸi gibi, morbid obez hastalar (VKÄ° > 50) iÃ§in <strong>cerrahiye kÃ¶prÃ¼ tedavisi</strong> olarak da kullanÄ±labilir.</p>
      </div></div>
    </div>

    <div class="acc-item">
      <button class="acc-head" onclick="toggleAcc(this)">
        <h4>ğŸ’Š ESG vs GLP-1 Ä°laÃ§lar</h4><span class="acc-arrow">â–¼</span>
      </button>
      <div class="acc-body"><div class="acc-inner">
        <table class="compare-table">
          <tr><th>Ã–zellik</th><th>ESG</th><th>GLP-1</th></tr>
          <tr><td>Uygulama</td><td>Tek seferlik iÅŸlem</td><td>GÃ¼nlÃ¼k/haftalÄ±k ilaÃ§</td></tr>
          <tr><td>Kilo kaybÄ±</td><td>%15-20</td><td>~%10</td></tr>
          <tr><td>SÃ¼re</td><td>KalÄ±cÄ±</td><td>Ä°laÃ§ sÃ¼resince</td></tr>
          <tr><td>Maliyet</td><td>Tek seferlik</td><td>SÃ¼rekli</td></tr>
          <tr><td>Geri dÃ¶nÃ¼ÅŸ</td><td>MÃ¼mkÃ¼n</td><td>Kesilince kilo alÄ±mÄ±</td></tr>
          <tr><td>Ek fayda</td><td>â€”</td><td>Kan ÅŸekeri kontrolÃ¼</td></tr>
          <tr><td>Yan etki</td><td>GeÃ§ici (2-3 gÃ¼n)</td><td>SÃ¼rekli olabilir</td></tr>
        </table>
        <h5>ESG Ä°Ã§in Ä°deal Aday</h5>
        <ul>
          <li>VKÄ° 30-40 arasÄ±</li>
          <li>HÄ±zlÄ± kilo kaybÄ± isteyenler</li>
          <li>Cerrahiden Ã§ekinenler</li>
          <li>Uzun sÃ¼reli ilaÃ§ kullanmak istemeyenler</li>
        </ul>
      </div></div>
    </div>

    <div class="acc-item">
      <button class="acc-head" onclick="toggleAcc(this)">
        <h4>ğŸ¯ Kimler Ä°Ã§in Uygundur?</h4><span class="acc-arrow">â–¼</span>
      </button>
      <div class="acc-body"><div class="acc-inner">
        <h5>Ä°deal Adaylar</h5>
        <ul>
          <li>VKÄ° 30-40 kg/mÂ² arasÄ±</li>
          <li>Diyet ve egzersizle yeterli sonuÃ§ alamayanlar</li>
          <li>Bariatrik cerrahiye uygun olmayan veya istemeyen hastalar</li>
          <li>Morbid obez hastalar iÃ§in cerrahiye hazÄ±rlÄ±k (kÃ¶prÃ¼ tedavisi)</li>
        </ul>
        <h5>ESG Uygun Olmayabilir</h5>
        <ul>
          <li>Daha Ã¶nce Ã¼st GÄ°S cerrahisi geÃ§irmiÅŸ hastalar</li>
          <li>Aktif mide Ã¼lseri veya gastrit olanlar</li>
          <li>Kanama bozukluklarÄ± olanlar</li>
        </ul>
      </div></div>
    </div>

    <div class="acc-item">
      <button class="acc-head" onclick="toggleAcc(this)">
        <h4>â” SÄ±k Sorulan 10 Soru</h4><span class="acc-arrow">â–¼</span>
      </button>
      <div class="acc-body"><div class="acc-inner">
        <h5>1. Ä°ÅŸlem ne kadar sÃ¼rer?</h5>
        <p>Genellikle 60-90 dakika sÃ¼rer.</p>
        <h5>2. Hastanede ne kadar kalÄ±rÄ±m?</h5>
        <p>Ã‡oÄŸu hasta aynÄ± gÃ¼n veya ertesi gÃ¼n taburcu olur.</p>
        <h5>3. Ne kadar sÃ¼rede iyileÅŸirim?</h5>
        <p>BirkaÃ§ gÃ¼n iÃ§inde normal aktivitelerinize dÃ¶nebilirsiniz.</p>
        <h5>4. ESG kalÄ±cÄ± mÄ±dÄ±r?</h5>
        <p>Evet, mide hacmini kalÄ±cÄ± olarak kÃ¼Ã§Ã¼ltÃ¼r. SonuÃ§lar yaÅŸam tarzÄ± alÄ±ÅŸkanlÄ±klarÄ±na baÄŸlÄ±dÄ±r.</p>
        <h5>5. Ne kadar kilo verilebilir?</h5>
        <p>Ä°lk yÄ±l fazla kilonun %15-20'si. SaÄŸlÄ±klÄ± yaÅŸam tarzÄ± ile 5 yÄ±la kadar korunabilir.</p>
        <h5>6. AÄŸrÄ±lÄ± mÄ±dÄ±r?</h5>
        <p>Ä°ÅŸlem genel anestezi altÄ±nda yapÄ±lÄ±r. SonrasÄ±nda 2-3 gÃ¼n hafif-orta karÄ±n aÄŸrÄ±sÄ± olabilir.</p>
        <h5>7. Tekrarlanabilir mi?</h5>
        <p>Evet, gerekirse prosedÃ¼r tekrarlanarak ek kilo kaybÄ± saÄŸlanabilir.</p>
        <h5>8. Geri dÃ¶ndÃ¼rÃ¼lebilir mi?</h5>
        <p>Evet, istenirse dikiÅŸler endoskopik olarak kesilerek mide eski haline getirilebilir.</p>
        <h5>9. Ä°ÅŸlem sonrasÄ± beslenme nasÄ±l olmalÄ±?</h5>
        <p>Ä°lk haftalarda sÄ±vÄ± diyet, sonra yumuÅŸak gÄ±dalar, 4. haftadan normal beslenme. Bu uygulamada tÃ¼m aÅŸamalar detaylÄ± anlatÄ±lmÄ±ÅŸtÄ±r.</p>
        <h5>10. ESG ile tÃ¼p mide ameliyatÄ± arasÄ±ndaki fark?</h5>
        <p>ESG cerrahi olmayan bir yÃ¶ntemdir, midenin dÄ±ÅŸ kÄ±smÄ±na mÃ¼dahale edilmez. TÃ¼p mide ise cerrahi olup midenin bir kÄ±smÄ± tamamen Ã§Ä±karÄ±lÄ±r. ESG daha az invaziv ve daha kÄ±sa iyileÅŸme sÃ¼resi sunar.</p>
      </div></div>
    </div>

  </div>

  <div class="info-card" style="text-align:center;margin-top:16px">
    <p style="font-size:12px;color:var(--muted)">Kaynak: <a href="https://endoskopiktupmide.org" style="color:var(--bx)" target="_blank">endoskopiktupmide.org</a><br>DoÃ§. Dr. Cem ÅimÅŸek Â· Bariatrik Endoskopi</p>
  </div>
</div>
</div>

<!-- INFO -->
<div id="s-info" class="scr">
<div class="box">
  <div class="sec-title" style="margin-top:16px">ğŸ“‹ Bilgi & Acil</div>

  <a href="tel:112" class="emer-btn">ğŸš¨ ACÄ°L DURUM â€” 112'yi Ara</a>

  <div class="sec-title">ğŸ“ Doktorunuza UlaÅŸÄ±n</div>
  <div class="contact-btns">
    <a href="https://t.me/+905316876758" class="contact-btn tg">âœˆï¸ Telegram</a>
    <a href="https://wa.me/905316876758" class="contact-btn wa">ğŸ’¬ WhatsApp</a>
  </div>

  <div class="alert">
    <h4>âš ï¸ Acil â€” Hemen BaÅŸvurun</h4>
    <p>â€¢ Åiddetli, artan karÄ±n aÄŸrÄ±sÄ±<br>â€¢ 38.5Â°C Ã¼zeri ateÅŸ<br>â€¢ SÃ¼rekli kusma (sÄ±vÄ± tutamama)<br>â€¢ KanlÄ± kusma / kanlÄ±-siyah dÄ±ÅŸkÄ±<br>â€¢ GÃ¶ÄŸÃ¼s aÄŸrÄ±sÄ± / nefes darlÄ±ÄŸÄ±</p>
  </div>

  <div class="alert alert-green">
    <h4>âœ… Normal (Beklenen) Belirtiler</h4>
    <p>â€¢ Hafif-orta karÄ±n aÄŸrÄ±sÄ± (3â€“5 gÃ¼n)<br>â€¢ BulantÄ± (ilk 2â€“3 gÃ¼n)<br>â€¢ BoÄŸaz aÄŸrÄ±sÄ± (1â€“2 gÃ¼n)<br>â€¢ Gaz, ÅŸiÅŸkinlik, omuz aÄŸrÄ±sÄ±<br>â€¢ Halsizlik (ilk hafta)</p>
  </div>

  <div class="sec-title">ğŸ’Š Vitamin & Takviye</div>
  <div class="info-card">
    <table class="vtable">
      <tr><th>Takviye</th><th>Doz</th><th>BaÅŸlangÄ±Ã§</th></tr>
      <tr><td>Multivitamin</td><td>1â€“2 tablet/gÃ¼n (Ã§iÄŸneme)</td><td>2. hafta</td></tr>
      <tr><td>Kalsiyum + D</td><td>1200â€“1500mg + 3000 IU</td><td>2. hafta</td></tr>
      <tr><td>B12</td><td>1000 mcg/gÃ¼n oral</td><td>2. hafta</td></tr>
      <tr><td>PPI</td><td>Doktor reÃ§etesiyle</td><td>Hemen</td></tr>
    </table>
  </div>

  <div class="sec-title">ğŸ“… Takip RandevularÄ±</div>
  <div class="info-card"><div class="timeline" id="followupTimeline"></div></div>

  <div class="sec-title">âš ï¸ GLP-1 Ä°laÃ§ UyarÄ±sÄ±</div>
  <div class="alert alert-orange">
    <h4>Ozempic, Wegovy, Mounjaro, Saxenda...</h4>
    <p>GLP-1 agonistleri mide boÅŸalmasÄ±nÄ± yavaÅŸlatÄ±r. <strong>Ä°ÅŸlemden en az 1â€“3 hafta Ã¶nce</strong> doktorunuzla gÃ¶rÃ¼ÅŸerek kesilmelidir.</p>
  </div>

  <div class="sec-title">ğŸ“ Ä°letiÅŸim</div>
  <div class="info-card">
    <h3>ğŸ‘¨â€âš•ï¸ DoÃ§. Dr. Cem ÅimÅŸek</h3>
    <p>Bariatrik Endoskopi / Gastroenteroloji<br>ğŸ“± <a href="tel:+905316876758" style="color:var(--bx);font-weight:600">0531 687 67 58</a><br><span style="font-size:12px;color:var(--muted)">Sorun durumunda 7/24 ulaÅŸÄ±labilir</span></p>
  </div>

  <div class="info-card" style="text-align:center">
    <p style="font-size:11px;color:var(--muted)">Bu rehber gÃ¼ncel uluslararasÄ± kÄ±lavuzlara dayanmaktadÄ±r.<br>ASMBS 2025 Â· IFSO 2024 Â· ASGE/ESGE Â· NICE IPG783<br>Doktorunuzun size Ã¶zel talimatlarÄ±na uyunuz.</p>
  </div>
</div>
</div>

<!-- NAV -->
<div id="nav" class="nav">
<div class="nav-in">
  <button class="nb on" data-tab="home" onclick="go('home')"><span class="ni">ğŸ </span>Ana Sayfa</button>
  <button class="nb" data-tab="esg" onclick="go('esg')"><span class="ni">âš•ï¸</span>ESG</button>
  <button class="nb" data-tab="diet" onclick="go('diet')"><span class="ni">ğŸ½ï¸</span>Beslenme</button>
  <button class="nb" data-tab="track" onclick="go('track')"><span class="ni">ğŸ’§</span>Takip</button>
  <button class="nb" data-tab="tasks" onclick="go('tasks')"><span class="ni">âœ…</span>GÃ¶revler</button>
  <button class="nb" data-tab="info" onclick="go('info')"><span class="ni">â„¹ï¸</span>Acil</button>
</div>
</div>

<script>
// â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•
const PHASES = [
  {id:'pre2w', name:'Ä°ÅŸlem Ã–ncesi Diyet', tag:'2 Hafta Ã–ncesinden', color:'purple', dayRange:[-14,-3],
   desc:'DÃ¼ÅŸÃ¼k kalorili, yÃ¼ksek proteinli diyet ile karaciÄŸer yaÄŸlanmasÄ±nÄ± azaltÄ±n. Protein hedefi: gÃ¼nde 60-80g.'},
  {id:'pre3d', name:'SÄ±vÄ± Diyet GeÃ§iÅŸi', tag:'Son 2â€“3 GÃ¼n', color:'orange', dayRange:[-3,-1],
   desc:'Tamamen sÄ±vÄ± diyete geÃ§in: su, berrak et suyu, protein shake, sade Ã§ay.'},
  {id:'npo', name:'Ä°ÅŸlem GÃ¼nÃ¼ (NPO)', tag:'Ä°ÅŸlem GÃ¼nÃ¼', color:'bx', dayRange:[0,0],
   desc:'Gece yarÄ±sÄ±ndan itibaren hiÃ§bir ÅŸey yemeyin/iÃ§meyin. RefakatÃ§i zorunludur.'},
  {id:'phase1', name:'Faz 1: Berrak SÄ±vÄ±', tag:'0â€“3. GÃ¼n', color:'blue', dayRange:[0,3],
   desc:'Hidrasyon odaklÄ±. 15 dk\'da 30-60 ml kÃ¼Ã§Ã¼k yudumlar. GÃ¼nde 1.5-2 litre.'},
  {id:'phase2', name:'Faz 2: Tam SÄ±vÄ± + Protein', tag:'3â€“14. GÃ¼n', color:'green', dayRange:[3,14],
   desc:'GÃ¼nde 60-90g protein + 2+ litre sÄ±vÄ±. GÃ¼nde 2-3 protein shake. Vitamin takviyesine baÅŸlayÄ±n.'},
  {id:'phase3', name:'Faz 3: YumuÅŸak GÄ±da', tag:'2â€“4. Hafta', color:'orange', dayRange:[14,28],
   desc:'Ã‡atalla ezilecek kÄ±vam. Her Ã¶ÄŸÃ¼nde Ã–NCE protein! 3 kÃ¼Ã§Ã¼k Ã¶ÄŸÃ¼n + 1 atÄ±ÅŸtÄ±rmalÄ±k.'},
  {id:'phase4', name:'Faz 4: Normal SaÄŸlÄ±klÄ± Diyet', tag:'4. Hafta+ (YaÅŸam Boyu)', color:'bx', dayRange:[28,9999],
   desc:'Protein â†’ Sebze â†’ Karbonhidrat sÄ±rasÄ±. Ã‡ay tabaÄŸÄ± boyutu porsiyon. GazlÄ± iÃ§ecek yaÅŸam boyu yasak.'},
];

const FOODS = {
  pre2w: {
    yes:[['ğŸ—','Tavuk, balÄ±k, hindi (Ä±zgara)'],['ğŸ¥š','Yumurta'],['ğŸ§€','Lor/sÃ¼zme peynir'],['ğŸ¥›','YaÄŸsÄ±z yoÄŸurt'],['ğŸ¥¦','TÃ¼m sebzeler'],['ğŸ','Tam tahÄ±l ekmek (1-2 dilim)'],['ğŸ’§','Bol su (2.5+ lt)'],['ğŸ«˜','Baklagiller (az)']],
    no:[['ğŸŒ­','Ä°ÅŸlenmiÅŸ et (sucuk, salam)'],['ğŸ•','Beyaz ekmek, makarna, bÃ¶rek'],['ğŸ«','Åekerli gÄ±dalar'],['ğŸ¥¤','GazlÄ± iÃ§ecekler'],['ğŸŸ','KÄ±zartmalar'],['ğŸº','Alkol'],['ğŸ”','Fast-food']]
  },
  pre3d: {
    yes:[['ğŸ’§','Su'],['ğŸµ','Sade Ã§ay (kafeinsiz)'],['ğŸ²','Berrak et/tavuk suyu'],['ğŸ¥¤','SÃ¼zÃ¼lmÃ¼ÅŸ Ã§orba'],['ğŸ§‹','Protein shake'],['ğŸ§ƒ','SÃ¼zÃ¼lmÃ¼ÅŸ elma suyu']],
    no:[['ğŸ–','TÃ¼m katÄ± gÄ±dalar'],['â˜•','Kafeinli iÃ§ecekler'],['ğŸ¥›','SÃ¼t Ã¼rÃ¼nleri'],['ğŸ§ƒ','PosalÄ± meyve sularÄ±']]
  },
  phase1: {
    yes:[['ğŸ’§','Su'],['ğŸµ','Sade Ã§ay (kafeinsiz)'],['ğŸ²','Berrak et/tavuk suyu'],['ğŸ®','Åekersiz jelatin'],['ğŸ§ƒ','Berrak elma suyu'],['ğŸ§‹','Berrak protein iÃ§eceÄŸi']],
    no:[['ğŸ–','TÃ¼m katÄ± gÄ±dalar'],['â˜•','Kafein'],['ğŸ¥›','SÃ¼t Ã¼rÃ¼nleri'],['ğŸ¥¤','GazlÄ± iÃ§ecekler'],['ğŸ§ƒ','PosalÄ± sÄ±vÄ±lar'],['ğŸ¥¤','Pipet kullanmayÄ±n']]
  },
  phase2: {
    yes:[['ğŸ§‹','Protein shake (20-30g)'],['ğŸ²','SÃ¼zÃ¼lmÃ¼ÅŸ Ã§orbalar'],['ğŸ¥›','YaÄŸsÄ±z sÃ¼t'],['ğŸ¥£','Sade yoÄŸurt'],['ğŸ§ƒ','Ayran'],['ğŸ’§','Su (2+ lt)'],['ğŸµ','Sade Ã§ay'],['ğŸ²','Et suyu']],
    no:[['ğŸ–','KatÄ± gÄ±dalar'],['ğŸŸ','YaÄŸlÄ± gÄ±dalar'],['ğŸ¥¤','GazlÄ± iÃ§ecekler'],['ğŸ«','Åekerli gÄ±dalar'],['â˜•','Fazla kafein'],['ğŸ¥¤','Pipet kullanmayÄ±n']]
  },
  phase3: {
    yes:[['ğŸ¥š','Yumurta (rafadan/omlet)'],['ğŸŸ','YumuÅŸak balÄ±k, ton konserve'],['ğŸ¥©','Ä°nce kÄ±yma'],['ğŸ§€','Lor peyniri'],['ğŸƒ','Kabak, havuÃ§, patates ezmesi'],['ğŸ¥‘','Avokado, muz (ezme)'],['ğŸ','Elma pÃ¼resi, komposto'],['ğŸ«˜','Mercimek ezmesi, humus'],['ğŸ§€','Krem peynir (az yaÄŸlÄ±)'],['ğŸ','YumuÅŸak makarna (az)']],
    no:[['ğŸ¥–','Sert ekmek, kuru gÄ±dalar'],['ğŸ¥©','Sert/lifli et'],['ğŸŒ½','Ã‡iÄŸ sebzeler'],['ğŸŸ','KÄ±zartmalar'],['ğŸ¥¤','GazlÄ± iÃ§ecekler'],['ğŸ«','Åekerli gÄ±dalar'],['ğŸŒ¶ï¸','BaharatlÄ± gÄ±dalar']]
  },
  phase4: {
    yes:[['ğŸ—','Tavuk, hindi (Ä±zgara)'],['ğŸŸ','BalÄ±k'],['ğŸ¥š','Yumurta'],['ğŸ§€','Peynir (az yaÄŸlÄ±)'],['ğŸ«˜','Baklagiller'],['ğŸ¥¦','TÃ¼m sebzeler'],['ğŸ','Meyveler'],['ğŸ','Tam tahÄ±l (az)'],['ğŸ’§','2+ litre su/gÃ¼n'],['ğŸ¥—','Salata']],
    no:[['ğŸ¥¤','GazlÄ± iÃ§ecekler (YAÅAM BOYU)'],['ğŸ«','Åekerli gÄ±dalar/iÃ§ecekler'],['ğŸ”','Fast-food'],['ğŸŸ','KÄ±zartmalar'],['ğŸº','Alkol (ilk 6-12 ay)'],['ğŸ¿','SÃ¼rekli atÄ±ÅŸtÄ±rma']]
  }
};

const TASKS = {
  pre2w: [
    {t:'Kan tahlillerimi yaptÄ±rdÄ±m',d:'Tam kan, KC/bÃ¶brek, tiroid, HbA1c, lipid, demir, B12, D vit.'},
    {t:'Anestezi deÄŸerlendirmesi tamamlandÄ±',d:'EKG, akciÄŸer grafisi'},
    {t:'Diyetisyen gÃ¶rÃ¼ÅŸmesini yaptÄ±m',d:''},
    {t:'2 haftalÄ±k diyete baÅŸladÄ±m',d:'DÃ¼ÅŸÃ¼k kalorili, yÃ¼ksek proteinli'},
    {t:'Ä°laÃ§larÄ±mÄ± doktorumla gÃ¶zden geÃ§irdim',d:'Kan sulandÄ±rÄ±cÄ±lar, diyabet ilaÃ§larÄ±'},
    {t:'GLP-1 ilacÄ±m varsa kesildi',d:'Ozempic, Wegovy, Mounjaro â€” 1-3 hafta Ã¶nce'},
    {t:'NSAÄ°D kesildi (7 gÃ¼n Ã¶nce)',d:'Ä°buprofen, Naproksen â†’ Parasetamol kullanÄ±labilir'},
    {t:'Sigara bÄ±rakma sÃ¼recinde',d:'En az 4 hafta Ã¶nce'},
    {t:'Alkol kesildi',d:'2 hafta Ã¶nce'},
    {t:'Protein shake ve vitaminleri aldÄ±m',d:''},
    {t:'YumuÅŸak gÄ±da malzemeleri aldÄ±m',d:'Faz 3 iÃ§in hazÄ±rlÄ±k'},
    {t:'RefakatÃ§im hazÄ±r',d:''},
  ],
  pre3d: [
    {t:'Tamamen sÄ±vÄ± diyete geÃ§tim',d:'Su, berrak et suyu, protein shake'},
    {t:'Protein shake devam',d:'GÃ¼nde 2-3'},
    {t:'Bol su iÃ§iyorum',d:'2+ litre'},
    {t:'NPO kuralÄ±nÄ± biliyorum',d:'Gece yarÄ±sÄ±ndan itibaren aÃ§'},
  ],
  npo: [
    {t:'Gece yarÄ±sÄ±ndan beri aÃ§',d:''},
    {t:'OnaylÄ± ilaÃ§larÄ± az su ile aldÄ±m',d:''},
    {t:'RefakatÃ§im benimle',d:''},
    {t:'Rahat kÄ±yafet giydim',d:''},
  ],
  phase1: [
    {t:'15 dk\'da 30-60 ml su yudumladÄ±m',d:''},
    {t:'Berrak et suyu/tavuk suyu iÃ§tim',d:''},
    {t:'SÄ±vÄ± alÄ±mÄ±mÄ± kaydettim',d:'1.5-2 litre hedef'},
    {t:'Ä°laÃ§larÄ±mÄ± aldÄ±m',d:'PPI + reÃ§eteli ilaÃ§lar'},
    {t:'Pipet kullanmadÄ±m',d:''},
    {t:'KÄ±sa yÃ¼rÃ¼yÃ¼ÅŸ yaptÄ±m (5-10 dk)',d:''},
  ],
  phase2: [
    {t:'Protein shake iÃ§tim (2-3 adet)',d:'Her biri 20-30g protein'},
    {t:'60g protein hedefine ulaÅŸtÄ±m',d:''},
    {t:'2+ litre sÄ±vÄ± aldÄ±m',d:''},
    {t:'Vitamin takviyesine baÅŸladÄ±m',d:'Multivitamin + Kalsiyum + D + B12'},
    {t:'YÃ¼rÃ¼yÃ¼ÅŸ (20-30 dk)',d:''},
  ],
  phase3: [
    {t:'Ã–nce proteini yedim',d:'Her Ã¶ÄŸÃ¼nde ilk protein'},
    {t:'Ã‡atalla ezilecek kÄ±vamda yedim',d:''},
    {t:'3 kÃ¼Ã§Ã¼k Ã¶ÄŸÃ¼n + 1 atÄ±ÅŸtÄ±rmalÄ±k',d:'Her Ã¶ÄŸÃ¼n 15-20 dk'},
    {t:'YavaÅŸ Ã§iÄŸnedim (20+ kez)',d:''},
    {t:'Tok olunca durdum',d:''},
    {t:'Vitaminlerimi aldÄ±m',d:''},
    {t:'Protein shake devam (gÃ¼nde 1)',d:''},
  ],
  phase4: [
    {t:'Protein â†’ Sebze â†’ Karbonhidrat sÄ±rasÄ±',d:''},
    {t:'Ã‡ay tabaÄŸÄ± boyutu porsiyon',d:''},
    {t:'Yemekle iÃ§meyi ayÄ±rdÄ±m',d:'15 dk Ã¶nce bÄ±rak, 30 dk sonra baÅŸla'},
    {t:'2+ litre su iÃ§tim (Ã¶ÄŸÃ¼n arasÄ±)',d:''},
    {t:'Vitaminlerimi aldÄ±m',d:''},
    {t:'Egzersiz yaptÄ±m',d:'Hedef: 150+ dk/hafta'},
    {t:'Yemek gÃ¼nlÃ¼ÄŸÃ¼ tuttum',d:''},
    {t:'GazlÄ± iÃ§ecek iÃ§medim',d:'YaÅŸam boyu yasak'},
  ],
};

const FOLLOWUP = [
  {time:'1. Hafta',desc:'Telefon/online â€” iyileÅŸme, sÄ±vÄ± alÄ±mÄ±, ilaÃ§ uyumu'},
  {time:'2. Hafta',desc:'Muayene â€” yumuÅŸak gÄ±daya geÃ§iÅŸ, vitamin baÅŸlangÄ±cÄ±'},
  {time:'1. Ay',desc:'Diyetisyen â€” normal diyete geÃ§iÅŸ, kilo takibi'},
  {time:'3. Ay',desc:'Kan tahlili â€” vitamin dÃ¼zeyleri, kilo deÄŸerlendirmesi'},
  {time:'6. Ay',desc:'KapsamlÄ± kontrol â€” metabolik parametreler'},
  {time:'12. Ay',desc:'YÄ±llÄ±k â€” endoskopi (gerekirse), uzun vadeli plan'},
];

// â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•
const SK='esgrehber2';
let S={};
function save2(){ if(S._key) localStorage.setItem(S._key, JSON.stringify(S)); }
function todayKey(){ return new Date().toISOString().slice(0,10); }

// â•â•â•â•â•â•â• TC VALIDATION â•â•â•â•â•â•â•
function validateTC(){
  const v=tcInput.value.replace(/\D/g,'');
  tcInput.value=v;
  tcBtn.disabled=!isValidTC(v);
}
function isValidTC(tc){
  if(tc.length!==11||tc[0]==='0') return false;
  const d=tc.split('').map(Number);
  const s10=((d[0]+d[2]+d[4]+d[6]+d[8])*7-(d[1]+d[3]+d[5]+d[7]))%10;
  if(s10!==d[9]) return false;
  let sum=0;for(let i=0;i<10;i++) sum+=d[i];
  return sum%10===d[10];
}
async function hashTC(tc){
  const buf=await crypto.subtle.digest('SHA-256',new TextEncoder().encode(tc));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
async function wizSetTC(){
  const tc=tcInput.value;
  if(!isValidTC(tc)) return;
  const h=await hashTC(tc);
  // Check existing
  const allKeys=Object.keys(localStorage).filter(k=>k.startsWith(SK+'_')&&k!==SK+'_current');
  let found=null;
  for(const k of allKeys){
    try{const d=JSON.parse(localStorage.getItem(k));if(d&&d.tch===h){found=k;break;}}catch(e){}
  }
  if(found){
    S=JSON.parse(localStorage.getItem(found));
    S._key=found;
    save2();
    localStorage.setItem(SK+'_current',found);
    startApp();
    return;
  }
  S={tch:h,created:Date.now()};
  const key=SK+'_'+Date.now();
  S._key=key;
  localStorage.setItem(key,JSON.stringify(S));
  localStorage.setItem(SK+'_current',key);
  startApp();
}

// â•â•â•â•â•â•â• WIZARD â•â•â•â•â•â•â•
function wizNext(step){
  document.querySelectorAll('.wiz-step').forEach(s=>s.classList.remove('on'));
  document.querySelector(`.wiz-step[data-step="${step}"]`).classList.add('on');
}

// â•â•â•â•â•â•â• APP START â•â•â•â•â•â•â•
function startApp(){
  document.getElementById('wizard').classList.remove('on');
  document.getElementById('nav').classList.add('on');
  go('home');
}

// â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•
function go(tab){
  document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));
  document.getElementById('s-'+tab).classList.add('on');
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('on'));
  document.querySelector(`.nb[data-tab="${tab}"]`).classList.add('on');
  if(tab==='home') renderHome();
  if(tab==='diet') renderDiet();
  if(tab==='track') renderTrack();
  if(tab==='tasks') renderTasks();
  if(tab==='info') renderInfo();
  window.scrollTo(0,0);
}

// â•â•â•â•â•â•â• PHASE LOGIC â•â•â•â•â•â•â•
function getDaysSinceProc(){
  if(!S.procDate) return null;
  const proc=new Date(S.procDate+'T00:00:00');
  const now=new Date(); now.setHours(0,0,0,0);
  return Math.floor((now-proc)/(1000*60*60*24));
}
function getCurrentPhase(){
  const days=getDaysSinceProc();
  if(days===null) return null;
  if(days<-3) return PHASES[0];
  if(days<0) return PHASES[1];
  if(days===0) return PHASES[2];
  if(days<=3) return PHASES[3];
  if(days<=14) return PHASES[4];
  if(days<=28) return PHASES[5];
  return PHASES[6];
}

// â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•
function renderHome(){
  const hero=document.getElementById('homeHero');
  const days=getDaysSinceProc();
  const phase=getCurrentPhase();

  if(days!==null && days<0){
    hero.innerHTML=`<div class="hero-label">Ä°ÅLEME KALAN</div>
      <div class="hero-big">${Math.abs(days)}<span class="hero-unit">gÃ¼n</span></div>
      <div class="hero-detail">${new Date(S.procDate+'T00:00:00').toLocaleDateString('tr-TR',{weekday:'long',day:'numeric',month:'long'})}</div>`;
  } else if(days!==null && days>=0){
    hero.innerHTML=`<div class="hero-label">Ä°ÅLEMDEN BU YANA</div>
      <div class="hero-big">${days}<span class="hero-unit">gÃ¼n</span></div>
      <div class="hero-detail">${phase?phase.name:''}</div>`;
  } else {
    hero.innerHTML=`<div class="hero-label">ESG REHBERÄ°M</div>
      <div class="hero-small" style="margin-top:8px">Endoskopik Sleeve Gastroplasti<br>HazÄ±rlÄ±k & Takip Rehberi</div>
      <div class="hero-detail" style="margin-top:12px">TÃ¼m aÅŸamalarÄ± aÅŸaÄŸÄ±da inceleyebilirsiniz.<br>Ä°ÅŸlem tarihinizi girerek kiÅŸiselleÅŸtirin.</div>`;
  }

  // Date setter
  const ds=document.getElementById('dateSet');
  const di=document.getElementById('procDateInput');
  if(S.procDate){
    di.value=S.procDate;
    const info=document.getElementById('dateSetInfo');
    if(phase){
      info.innerHTML=`<span style="font-size:13px;color:var(--bx);font-weight:600">ğŸ“ Åu an: ${phase.name}</span>
        <br><button class="btn btn-ghost" style="font-size:12px;margin-top:4px" onclick="clearDate()">Tarihi KaldÄ±r</button>`;
    }
  }

  // Weekly weight reminder
  const wr=document.getElementById('weightReminder');
  if(shouldShowWeightReminder()){
    wr.style.display='block';
    wr.innerHTML=`<div class="reminder-banner"><h4>âš–ï¸ HaftalÄ±k TartÄ±lma ZamanÄ±!</h4>
      <p>Son Ã¶lÃ§Ã¼mÃ¼nÃ¼zÃ¼n Ã¼zerinden 7+ gÃ¼n geÃ§ti.</p>
      <button class="btn btn-outline" style="margin-top:8px;padding:12px" onclick="go('track')">TartÄ±l â†’</button></div>`;
  } else { wr.style.display='none'; }

  // Phase list â€” show ALL phases
  const pl=document.getElementById('phaseList');
  pl.innerHTML=PHASES.map((p,i)=>{
    const isCurrent=phase&&phase.id===p.id;
    return `<div class="phase-card ${p.color} ${isCurrent?'active-glow':''}" onclick="goToPhase('${p.id}')">
      ${isCurrent?'<div class="pc-badge">Åu An</div>':''}
      <div class="pc-tag ${p.color}">${p.tag}</div>
      <div class="pc-title">${p.name}</div>
      <div class="pc-desc">${p.desc}</div>
    </div>`;
  }).join('');
}

function goToPhase(phaseId){
  const idx=PHASES.findIndex(p=>p.id===phaseId);
  if(idx>=0 && idx<=2){ taskPhaseIdx=idx; go('tasks'); }
  else { dietPhaseIdx=idx; go('diet'); }
}

function setProcDate(){
  const v=document.getElementById('procDateInput').value;
  if(v){ S.procDate=v; save2(); renderHome(); }
}
function clearDate(){
  delete S.procDate;
  save2();
  document.getElementById('procDateInput').value='';
  document.getElementById('dateSetInfo').innerHTML='';
  renderHome();
}

function shouldShowWeightReminder(){
  if(!S.measures||!S.measures.length) return S.procDate?true:false;
  const last=S.measures[S.measures.length-1].date;
  const diff=(new Date()-new Date(last))/(1000*60*60*24);
  return diff>=7;
}

// â•â•â•â•â•â•â• DIET â•â•â•â•â•â•â•
let dietPhaseIdx=3; // Default to phase1
function renderDiet(){
  const phase=getCurrentPhase();
  if(phase && dietPhaseIdx===3){
    const idx=PHASES.indexOf(phase);
    if(idx>=0) dietPhaseIdx=idx;
  }

  const tabs=document.getElementById('dietPhaseTabs');
  tabs.innerHTML=PHASES.map((p,i)=>{
    return `<div class="dtab ${i===dietPhaseIdx?'on':''}" onclick="setDietPhase(${i})">${p.name.replace('Faz '+(['1','2','3','4'][i-3])+': ','')}</div>`;
  }).join('');

  renderDietContent();
}
function setDietPhase(idx){ dietPhaseIdx=idx; renderDiet(); }
function renderDietContent(){
  const phase=PHASES[dietPhaseIdx];
  const el=document.getElementById('dietContent');
  const foods=FOODS[phase.id]||FOODS.phase4;

  let html=`<div class="phase-card ${phase.color}">
    <div class="pc-tag ${phase.color}">${phase.tag}</div>
    <div class="pc-title">${phase.name}</div>
    <div class="pc-desc">${phase.desc}</div></div>`;

  if(foods.yes&&foods.yes.length){
    html+=`<div class="food-section"><h4 style="color:var(--green)">âœ… TÃ¼ketebilecekleriniz</h4><div class="food-grid">`;
    foods.yes.forEach(f=>{html+=`<div class="food-item yes"><span class="fi-ico">${f[0]}</span>${f[1]}</div>`;});
    html+=`</div></div>`;
  }
  if(foods.no&&foods.no.length){
    html+=`<div class="food-section"><h4 style="color:var(--red)">ğŸš« KaÃ§Ä±nmanÄ±z Gerekenler</h4><div class="food-grid">`;
    foods.no.forEach(f=>{html+=`<div class="food-item no"><span class="fi-ico">${f[0]}</span>${f[1]}</div>`;});
    html+=`</div></div>`;
  }

  // Phase tips
  const tips={
    pre2w:`<div class="alert alert-orange"><h4>ğŸ’¡ Ä°pucu</h4><p>TabaÄŸÄ±nÄ±zÄ±n yarÄ±sÄ±nÄ± proteinle doldurun. Bol su â€” gÃ¼nde 2.5+ litre.</p></div>`,
    pre3d:`<div class="alert alert-orange"><h4>ğŸ’¡ Ä°pucu</h4><p>Protein shake devam. Berrak Ã§orbalar ve bol su. AÃ§lÄ±k hissederseniz berrak et suyu yudumlayin.</p></div>`,
    npo:`<div class="alert"><h4>ğŸš« NPO â€” HiÃ§bir Åey Yemeyin/Ä°Ã§meyin</h4><p>Gece yarÄ±sÄ±ndan itibaren. OnaylÄ± ilaÃ§lar az su ile alÄ±nabilir. <strong>Ä°hlal iÅŸlemin iptaline neden olabilir.</strong></p></div>`,
    phase1:`<div class="alert alert-orange"><h4>ğŸ’¡ Ä°pucu</h4><p>30ml Ã¶lÃ§Ã¼m kabÄ± kullanÄ±n, 5 dk'da 1 yudum. Saatte 150ml aÅŸmayÄ±n. Tok hissedince durun.</p></div>`,
    phase2:`<div class="info-card"><h3>ğŸ“‹ Ã–rnek GÃ¼nlÃ¼k Plan</h3><p>
      <strong>08:00</strong> Protein shake (20-30g)<br><strong>10:00</strong> Su / dÃ¼ÅŸÃ¼k kalorili iÃ§ecek<br>
      <strong>12:00</strong> Protein shake<br><strong>14:00</strong> SÃ¼zÃ¼lmÃ¼ÅŸ Ã§orba + su<br>
      <strong>16:00</strong> Protein shake<br><strong>18:00</strong> Sade yoÄŸurt + ayran<br>
      <strong>20:00</strong> Su veya Ã§ay</p></div>`,
    phase3:`<div class="info-card"><h3>ğŸ“‹ Yemek KurallarÄ±</h3><p>
      â€¢ <strong>Ã–nce protein</strong> â€” her Ã¶ÄŸÃ¼nde ilk<br>â€¢ <strong>YavaÅŸ Ã§iÄŸneyin</strong> â€” 20+ kez<br>
      â€¢ <strong>15-20 dk Ã¶ÄŸÃ¼n</strong><br>â€¢ <strong>Tok olunca durun</strong><br>
      â€¢ GÃ¼nde 1 protein shake devam<br>â€¢ SÄ±vÄ±larÄ± yemekten ayrÄ± iÃ§in</p></div>`,
    phase4:`<div class="info-card"><h3>ğŸ“ SaÄŸlÄ±klÄ± Tabak Modeli</h3>
      <p style="text-align:center;font-size:15px;margin:8px 0">
      <span style="display:inline-block;background:var(--dark);color:var(--bx);padding:10px 16px;border-radius:10px;font-weight:700">Â½ PROTEÄ°N</span>
      <span style="display:inline-block;background:var(--green-l);color:var(--green);padding:10px 12px;border-radius:10px;font-weight:700">Â¼ SEBZE</span>
      <span style="display:inline-block;background:var(--orange-l);color:var(--orange);padding:10px 12px;border-radius:10px;font-weight:700">Â¼ KARBONHÄ°DRAT</span></p></div>`,
  };
  if(tips[phase.id]) html+=tips[phase.id];
  if(['phase3','phase4'].includes(phase.id)){
    html+=`<div class="alert alert-orange"><h4>ğŸš° SÄ±vÄ± KuralÄ±</h4><p>Yemekten <strong>15 dk Ã¶nce</strong> bÄ±rakÄ±n, <strong>30 dk sonra</strong> baÅŸlayÄ±n.</p></div>`;
  }
  el.innerHTML=html;
}

function searchFood(){
  const q=document.getElementById('foodSearch').value.toLowerCase().trim();
  const el=document.getElementById('foodResults');
  if(!q||q.length<2){el.innerHTML='';return;}
  let results=[];
  Object.entries(FOODS).forEach(([pid,fd])=>{
    const pname=PHASES.find(p=>p.id===pid)?.name||pid;
    if(fd.yes) fd.yes.forEach(f=>{if(f[1].toLowerCase().includes(q)) results.push({ico:f[0],txt:f[1],type:'yes',phase:pname});});
    if(fd.no) fd.no.forEach(f=>{if(f[1].toLowerCase().includes(q)) results.push({ico:f[0],txt:f[1],type:'no',phase:pname});});
  });
  // Deduplicate
  const seen=new Set();
  results=results.filter(r=>{const k=r.txt+r.type+r.phase;if(seen.has(k))return false;seen.add(k);return true;});
  if(!results.length){el.innerHTML=`<div class="info-card"><p style="text-align:center">SonuÃ§ bulunamadÄ±. Doktorunuza danÄ±ÅŸÄ±n.</p></div>`;return;}
  el.innerHTML=results.map(r=>`<div class="food-item ${r.type}" style="margin:4px 0"><span class="fi-ico">${r.ico}</span><span>${r.txt}</span><span style="font-size:11px;color:var(--muted);margin-left:auto;white-space:nowrap">${r.phase}</span></div>`).join('');
}

// â•â•â•â•â•â•â• TRACKING â•â•â•â•â•â•â•
function renderTrack(){
  const today=todayKey();
  if(!S.protein) S.protein={};
  if(!S.hydration) S.hydration={};

  const protein=S.protein[today]||0;
  const pGoal=60;
  document.getElementById('proteinCount').textContent=`${protein} / ${pGoal} g`;
  document.getElementById('proteinFill').style.width=Math.min(100,protein/pGoal*100)+'%';
  document.getElementById('proteinBtns').innerHTML=[10,15,20,25,30].map(v=>`<div class="track-btn" onclick="addProtein(${v})">${v}g</div>`).join('');

  const hydro=S.hydration[today]||0;
  const hGoal=2000;
  document.getElementById('hydroCount').textContent=`${hydro} / ${hGoal} ml`;
  document.getElementById('hydroFill').style.width=Math.min(100,hydro/hGoal*100)+'%';
  document.getElementById('hydroBtns').innerHTML=[50,100,150,200,250,330].map(v=>`<div class="track-btn" onclick="addHydro(${v})">${v}</div>`).join('');

  renderMeasureLog();
}
function addProtein(g){const t=todayKey();if(!S.protein)S.protein={};S.protein[t]=(S.protein[t]||0)+g;save2();renderTrack();}
function addHydro(ml){const t=todayKey();if(!S.hydration)S.hydration={};S.hydration[t]=(S.hydration[t]||0)+ml;save2();renderTrack();}

function logMeasure(){
  const w=parseFloat(document.getElementById('weightInput').value);
  const waist=parseFloat(document.getElementById('waistInput').value);
  if(!w&&!waist) return;
  if(!S.measures) S.measures=[];
  const entry={date:todayKey()};
  if(w&&w>=30&&w<=300) entry.kg=w;
  if(waist&&waist>=40&&waist<=250) entry.cm=waist;
  if(!entry.kg&&!entry.cm) return;
  S.measures.push(entry);
  save2();
  document.getElementById('weightInput').value='';
  document.getElementById('waistInput').value='';
  renderMeasureLog();
}
function renderMeasureLog(){
  const el=document.getElementById('measureLog');
  if(!S.measures||!S.measures.length){el.innerHTML='<p style="font-size:13px;color:var(--muted);text-align:center;margin-top:8px">HenÃ¼z kayÄ±t yok</p>';return;}
  const recent=S.measures.slice(-10).reverse();
  let html='';

  if(S.measures.length>=2){
    const first=S.measures[0]; const last=S.measures[S.measures.length-1];
    if(first.kg&&last.kg){
      const diff=(last.kg-first.kg).toFixed(1);
      const color=diff<0?'var(--green)':diff>0?'var(--red)':'var(--muted)';
      html+=`<div style="text-align:center;margin:12px 0"><span style="font-size:16px;font-weight:700;color:${color}">âš–ï¸ ${diff>0?'+':''}${diff} kg toplam</span></div>`;
    }
    if(first.cm&&last.cm){
      const diff=(last.cm-first.cm).toFixed(1);
      const color=diff<0?'var(--green)':diff>0?'var(--red)':'var(--muted)';
      html+=`<div style="text-align:center;margin:4px 0"><span style="font-size:14px;font-weight:600;color:${color}">ğŸ“ ${diff>0?'+':''}${diff} cm bel</span></div>`;
    }
  }

  html+=recent.map(m=>`<div class="info-card" style="padding:12px 16px;margin:6px 0;display:flex;justify-content:space-between;align-items:center">
    <span style="font-size:13px;color:var(--muted)">${new Date(m.date).toLocaleDateString('tr-TR')}</span>
    <span style="font-size:16px;font-weight:700;color:var(--dark)">${m.kg?m.kg+' kg':''}${m.kg&&m.cm?' Â· ':''}${m.cm?m.cm+' cm':''}</span>
  </div>`).join('');
  el.innerHTML=html;
}

// â•â•â•â•â•â•â• TASKS â•â•â•â•â•â•â•
let taskPhaseIdx=0;
function renderTasks(){
  const phase=getCurrentPhase();
  if(phase){
    const idx=PHASES.indexOf(phase);
    if(idx>=0) taskPhaseIdx=idx;
  }

  const tabs=document.getElementById('taskTabs');
  tabs.innerHTML=PHASES.map((p,i)=>`<div class="dtab ${i===taskPhaseIdx?'on':''}" onclick="setTaskPhase(${i})">${p.name.replace('Faz '+(['1','2','3','4'][i-3])+': ','')}</div>`).join('');
  renderTaskList();
}
function setTaskPhase(idx){taskPhaseIdx=idx;renderTasks();}
function renderTaskList(){
  const phase=PHASES[taskPhaseIdx];
  const tasks=TASKS[phase.id]||TASKS.phase4;
  const today=todayKey();
  if(!S.tasks)S.tasks={};
  if(!S.tasks[phase.id])S.tasks[phase.id]={};

  const el=document.getElementById('tasksList');
  const done=Object.values(S.tasks[phase.id]).filter(v=>v).length;
  const total=tasks.length;
  const pct=Math.round(done/total*100);

  let html=`<div class="phase-card ${phase.color}" style="margin-bottom:12px">
    <div class="pc-tag ${phase.color}">${phase.tag}</div>
    <div class="pc-title">${phase.name}</div>
    <div class="prog" style="margin-top:8px"><div class="prog-bar"><div class="prog-fill" style="width:${pct}%;background:var(--green)"></div></div>
    <div class="prog-labels"><span>${done} / ${total}</span><span>${pct}%</span></div></div></div>`;

  tasks.forEach((t,i)=>{
    const isDone=S.tasks[phase.id][i];
    html+=`<div class="task ${isDone?'done':''}" onclick="toggleTask(${i})">
      <div class="tck">${isDone?'âœ“':''}</div>
      <div class="t-body"><h4>${t.t}</h4>${t.d?`<p>${t.d}</p>`:''}</div></div>`;
  });
  el.innerHTML=html;
}
function toggleTask(i){
  const phase=PHASES[taskPhaseIdx];
  if(!S.tasks)S.tasks={};
  if(!S.tasks[phase.id])S.tasks[phase.id]={};
  S.tasks[phase.id][i]=!S.tasks[phase.id][i];
  save2();renderTaskList();
}

// â•â•â•â•â•â•â• INFO â•â•â•â•â•â•â•
function renderInfo(){
  const el=document.getElementById('followupTimeline');
  const days=getDaysSinceProc()||-999;
  const thresholds=[7,14,30,90,180,365];
  el.innerHTML=FOLLOWUP.map((f,i)=>`<div class="tl-item ${days>=thresholds[i]?'done':''}"><h4>${f.time}</h4><p>${f.desc}</p></div>`).join('');
}

// â•â•â•â•â•â•â• ACCORDION â•â•â•â•â•â•â•
function toggleAcc(btn){
  const item=btn.parentElement;
  item.classList.toggle('open');
}

// â•â•â•â•â•â•â• RESET â•â•â•â•â•â•â•
function resetApp(){
  if(!confirm('Ã‡Ä±kÄ±ÅŸ yapÄ±lacak. Verileriniz bu cihazda saklanmaya devam eder. Emin misiniz?')) return;
  localStorage.removeItem(SK+'_current');
  S={};
  location.reload();
}

// â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•
function init(){
  const ck=localStorage.getItem(SK+'_current');
  if(ck){
    try{
      S=JSON.parse(localStorage.getItem(ck))||{};
      S._key=ck;
      if(S.tch){ startApp(); return; }
    }catch(e){}
  }
  document.getElementById('wizard').classList.add('on');
}
init();
</script>
</body>
</html>
